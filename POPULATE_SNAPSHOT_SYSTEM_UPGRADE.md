# üöÄ ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏£‡∏∞‡∏ö‡∏ö Populate + Snapshot

> **‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó**: 15 ‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏° 2568  
> **‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞**: ‚úÖ ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå

---

## üìã ‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á

‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏ô‡∏µ‡πâ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏ö Populate + Snapshot ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå‡πÅ‡∏•‡∏∞‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£:

**‚úÖ ‡πÉ‡∏ä‡πâ Populate ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà** - ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡πÄ‡∏™‡∏°‡∏≠  
**‚úÖ ‡πÉ‡∏ä‡πâ Snapshot ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏•‡∏ö** - ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÑ‡∏°‡πà‡∏´‡∏≤‡∏¢  
**‚úÖ ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥** - ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏≠‡∏á

---

## üéØ ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç

### ‚ùå **‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÄ‡∏î‡∏¥‡∏°**
1. **Snapshot ‡∏ú‡∏¥‡∏î‡πÄ‡∏ß‡∏•‡∏≤** - Snapshot Admin ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏•‡∏ö User (‡∏Ñ‡∏ß‡∏£ snapshot ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏•‡∏ö Admin)
2. **‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô** - ‡πÅ‡∏™‡∏î‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡πà‡∏≤‡πÅ‡∏°‡πâ Admin ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏•‡∏ö
3. **‡∏Ç‡∏≤‡∏î Populate Functions** - ‡∏´‡∏•‡∏≤‡∏¢‡∏´‡∏ô‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÉ‡∏ä‡πâ manual populate
4. **‡πÑ‡∏°‡πà‡∏°‡∏µ Snapshot ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Config** - ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏≤‡∏¢‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏•‡∏ö Status/Condition/Category
5. **‡πÑ‡∏°‡πà‡∏°‡∏µ Snapshot ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö ItemName** - ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏≤‡∏¢‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏•‡∏ö InventoryMaster ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î

### ‚úÖ **‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç**
1. **Snapshot ‡∏ñ‡∏π‡∏Å‡πÄ‡∏ß‡∏•‡∏≤** - Snapshot ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á‡πÜ
2. **‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡πá‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÄ‡∏™‡∏°‡∏≠** - ‡πÉ‡∏ä‡πâ Populate ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
3. **Populate ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô** - ‡∏°‡∏µ populate functions ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
4. **‡∏°‡∏µ Snapshot ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Config** - ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ (Status/Condition/Category)
5. **‡∏°‡∏µ Snapshot ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö ItemName** - ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ ‡πÅ‡∏°‡πâ InventoryMaster ‡∏ñ‡∏π‡∏Å‡∏•‡∏ö

---

## üì¶ Phase 1: ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Snapshot Logic

### ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
- `src/lib/snapshot-helpers.ts`

### ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á
‡πÄ‡∏û‡∏¥‡πà‡∏° comment ‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÉ‡∏´‡πâ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡∏ß‡πà‡∏≤ `snapshotUserBeforeDelete()` ‡∏à‡∏∞ snapshot ‡∏ó‡∏±‡πâ‡∏á Requester ‡πÅ‡∏•‡∏∞ Admin ‡πÄ‡∏û‡∏£‡∏≤‡∏∞ User ‡∏≠‡∏≤‡∏à‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó

---

## üîß Phase 2: ‡∏Ç‡∏¢‡∏≤‡∏¢ Populate Helpers

### ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
- `src/lib/equipment-populate-helpers.ts`

### ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á

#### 1. **‡πÄ‡∏û‡∏¥‡πà‡∏° Populate ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Item Names ‡πÅ‡∏•‡∏∞ Categories**
```typescript
// Populate item name ‡πÅ‡∏•‡∏∞ category ‡∏à‡∏≤‡∏Å masterId
if (item.masterId) {
  const itemInfo = await getItemNameAndCategory(item.masterId);
  if (itemInfo) {
    item.itemName = itemInfo.itemName;
    item.category = itemInfo.category;
    item.categoryId = itemInfo.categoryId;
  }
}
```

#### 2. **‡πÄ‡∏û‡∏¥‡πà‡∏° Populate ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö User Information**
```typescript
// Populate ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• User ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
if (populated.userId) {
  const user = await User.findOne({ user_id: populated.userId });
  if (user) {
    // Individual: Populate ‡∏ó‡∏∏‡∏Å‡∏ü‡∏¥‡∏•‡∏î‡πå
    // Branch: Populate ‡πÄ‡∏â‡∏û‡∏≤‡∏∞ office
  }
}
```

#### 3. **‡πÄ‡∏û‡∏¥‡πà‡∏° Complete Populate Functions**
```typescript
// Populate ‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÉ‡∏ô RequestLog
export async function populateRequestLogComplete(requestLog: any)

// Populate ‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÉ‡∏ô ReturnLog
export async function populateReturnLogComplete(returnLog: any)

// Batch functions
export async function populateRequestLogCompleteBatch(requestLogs: any[])
export async function populateReturnLogCompleteBatch(returnLogs: any[])
```

### ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°
- `populateRequestLogUser()` - Populate ‡∏ú‡∏π‡πâ‡πÄ‡∏ö‡∏¥‡∏Å
- `populateReturnLogUser()` - Populate ‡∏ú‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô
- `populateRequestLogComplete()` - Populate ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö RequestLog
- `populateReturnLogComplete()` - Populate ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö ReturnLog
- `populateRequestLogCompleteBatch()` - Batch version
- `populateReturnLogCompleteBatch()` - Batch version

---

## üåê Phase 3: ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó APIs

### ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç

#### 1. **`src/app/api/admin/equipment-reports/requests/route.ts`**
**‡∏Å‡πà‡∏≠‡∏ô**: 90+ ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏Ç‡∏≠‡∏á manual populate  
**‡∏´‡∏•‡∏±‡∏á**: 3 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÉ‡∏ä‡πâ `populateRequestLogCompleteBatch()`

```typescript
// ‡πÄ‡∏î‡∏¥‡∏°: manual populate ‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á (90+ ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î)
const enrichedRequests = await Promise.all(
  requests.map(async (req) => {
    // ... manual population code ...
  })
);

// ‡πÉ‡∏´‡∏°‡πà: ‡πÉ‡∏ä‡πâ populate function (3 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î)
const populatedRequests = await populateRequestLogCompleteBatch(requests);
```

#### 2. **`src/app/api/admin/equipment-reports/returns/route.ts`**
**‡∏Å‡πà‡∏≠‡∏ô**: 80+ ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏Ç‡∏≠‡∏á manual populate  
**‡∏´‡∏•‡∏±‡∏á**: 3 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÉ‡∏ä‡πâ `populateReturnLogCompleteBatch()`

```typescript
// ‡πÄ‡∏î‡∏¥‡∏°: manual populate ‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á (80+ ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î)
const enrichedReturns = await Promise.all(
  returns.map(async (returnLog) => {
    // ... manual population code ...
  })
);

// ‡πÉ‡∏´‡∏°‡πà: ‡πÉ‡∏ä‡πâ populate function (3 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î)
const populatedReturns = await populateReturnLogCompleteBatch(returns);
```

#### 3. **`src/app/api/admin/it-reports/route.ts`**
‚úÖ **‡πÉ‡∏ä‡πâ populate functions ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß** - ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç

### ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
- ‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡∏±‡πâ‡∏ô‡∏•‡∏á 90%
- ‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô
- ‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏á‡πà‡∏≤‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô
- ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏° 100%

---

## üîí Phase 4: ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏ö‡∏ö Snapshot ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Config

### ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç

#### 1. **`src/app/api/admin/inventory-config/statuses/[id]/route.ts`**

**‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á PUT (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ä‡∏∑‡πà‡∏≠)**:
```typescript
// ‡πÄ‡∏û‡∏¥‡πà‡∏°: Snapshot ‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏´‡∏°‡πà‡∏Å‡πà‡∏≠‡∏ô‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
await snapshotStatusConfigBeforeChange(id, name.trim());
```

**‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á DELETE (‡∏•‡∏ö)**:
```typescript
// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á Inventory ‡πÅ‡∏•‡∏∞ Logs
const inventoryUsage = await InventoryItem.countDocuments({ statusId: id });
const logsUsage = await checkStatusConfigUsage(id);

if (inventoryUsage > 0 || logsUsage.isUsed) {
  // ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡πÑ‡∏î‡πâ
}

// Snapshot ‡∏ä‡∏∑‡πà‡∏≠‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏•‡∏ö
await snapshotStatusConfigBeforeChange(id);

// ‡∏•‡∏ö Config
```

#### 2. **`src/app/api/admin/inventory-config/conditions/[id]/route.ts`**

**‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á PUT (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ä‡∏∑‡πà‡∏≠)**:
```typescript
// ‡πÄ‡∏û‡∏¥‡πà‡∏°: Snapshot ‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏´‡∏°‡πà‡∏Å‡πà‡∏≠‡∏ô‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
await snapshotConditionConfigBeforeChange(id, name.trim());
```

**‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á DELETE (‡∏•‡∏ö)**:
```typescript
// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á Inventory ‡πÅ‡∏•‡∏∞ Logs
const inventoryUsage = await InventoryItem.countDocuments({ conditionId: id });
const logsUsage = await checkConditionConfigUsage(id);

if (inventoryUsage > 0 || logsUsage.isUsed) {
  // ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡πÑ‡∏î‡πâ
}

// Snapshot ‡∏ä‡∏∑‡πà‡∏≠‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏•‡∏ö
await snapshotConditionConfigBeforeChange(id);

// ‡∏•‡∏ö Config
```

### ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏à‡∏≤‡∏Å `equipment-snapshot-helpers.ts`
- `snapshotStatusConfigBeforeChange()` - Snapshot Status
- `snapshotConditionConfigBeforeChange()` - Snapshot Condition
- `checkStatusConfigUsage()` - ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô Status
- `checkConditionConfigUsage()` - ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô Condition

### ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
- ‚úÖ ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö Config ‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
- ‚úÖ Snapshot ‡∏ä‡∏∑‡πà‡∏≠‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏•‡∏ö/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
- ‚úÖ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢

---

## üé® Phase 5: ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó UI Components

### ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
‚è≠Ô∏è **‡∏Ç‡πâ‡∏≤‡∏°‡πÑ‡∏õ** - UI Components ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç

### ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•
UI Components ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å API ‡∏ã‡∏∂‡πà‡∏á‡πÄ‡∏£‡∏≤‡πÑ‡∏î‡πâ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏ô Phase 3  
‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà API ‡∏™‡πà‡∏á‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà populate ‡πÅ‡∏•‡πâ‡∏ß ‡∏î‡∏±‡∏á‡∏ô‡∏±‡πâ‡∏ô UI ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á

---

## üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á

### ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (11 ‡πÑ‡∏ü‡∏•‡πå)

| ‡πÑ‡∏ü‡∏•‡πå | ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á | ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå |
|------|----------------|---------|
| `src/lib/snapshot-helpers.ts` | ‡πÄ‡∏û‡∏¥‡πà‡∏° comment ‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ | ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô |
| `src/lib/equipment-populate-helpers.ts` | ‡πÄ‡∏û‡∏¥‡πà‡∏° 140+ ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î | ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô |
| `src/lib/equipment-snapshot-helpers.ts` | ‡πÄ‡∏û‡∏¥‡πà‡∏° Category snapshot | ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô |
| `src/app/api/admin/equipment-reports/requests/route.ts` | ‡∏•‡∏î‡∏à‡∏≤‡∏Å 103 ‚Üí 32 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î | ‡∏™‡∏±‡πâ‡∏ô‡∏•‡∏á 70% |
| `src/app/api/admin/equipment-reports/returns/route.ts` | ‡∏•‡∏î‡∏à‡∏≤‡∏Å 93 ‚Üí 28 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î | ‡∏™‡∏±‡πâ‡∏ô‡∏•‡∏á 70% |
| `src/app/api/admin/inventory-config/statuses/[id]/route.ts` | ‡πÄ‡∏û‡∏¥‡πà‡∏° snapshot | ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô |
| `src/app/api/admin/inventory-config/conditions/[id]/route.ts` | ‡πÄ‡∏û‡∏¥‡πà‡∏° snapshot | ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô |
| `src/app/api/admin/inventory-config/categories/[id]/route.ts` | ‡πÄ‡∏û‡∏¥‡πà‡∏° snapshot | ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô |
| `src/app/api/equipment-request/route.ts` | ‡πÉ‡∏ä‡πâ populate functions | ‡∏™‡∏±‡πâ‡∏ô‡∏•‡∏á 50% |
| `src/app/api/equipment-return/route.ts` | ‡πÉ‡∏ä‡πâ populate functions | ‡∏™‡∏±‡πâ‡∏ô‡∏•‡∏á 50% |
| `src/app/api/user/return-logs/route.ts` | ‡πÉ‡∏ä‡πâ populate functions | ‡∏™‡∏±‡πâ‡∏ô‡∏•‡∏á 60% |

### ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏£‡∏ß‡∏°
- **‡πÄ‡∏û‡∏¥‡πà‡∏°**: ~150 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î (populate helpers)
- **‡∏•‡∏î**: ~135 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î (APIs)
- **‡∏™‡∏∏‡∏ó‡∏ò‡∏¥**: +15 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î ‡πÅ‡∏ï‡πà‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤‡∏Å

---

## ‚ú® ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå

### 1. **‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡πá‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÄ‡∏™‡∏°‡∏≠** ‚úÖ
```
‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 1: Admin A (‡∏ä‡∏∑‡πà‡∏≠: "‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ") ‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô Issue #001
‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 5: Admin A ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡πá‡∏ô "‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡∏°‡∏µ‡∏™‡∏∏‡∏Ç"
‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 10: ‡∏î‡∏π Issue #001 ‚Üí ‡πÅ‡∏™‡∏î‡∏á "‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡∏°‡∏µ‡∏™‡∏∏‡∏Ç" ‚úÖ (Populate)
‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 15: ‡∏•‡∏ö Admin A ‚Üí Snapshot "‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡∏°‡∏µ‡∏™‡∏∏‡∏Ç"
‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 20: ‡∏î‡∏π Issue #001 ‚Üí ‡πÅ‡∏™‡∏î‡∏á "‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡∏°‡∏µ‡∏™‡∏∏‡∏Ç" ‚úÖ (Snapshot)
```

### 2. **‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏´‡∏≤‡∏¢** ‚úÖ
- User ‡∏ñ‡∏π‡∏Å‡∏•‡∏ö ‚Üí ‡πÉ‡∏ä‡πâ Snapshot
- Admin ‡∏ñ‡∏π‡∏Å‡∏•‡∏ö ‚Üí ‡πÉ‡∏ä‡πâ Snapshot
- Status/Condition ‡∏ñ‡∏π‡∏Å‡∏•‡∏ö ‚Üí ‡πÉ‡∏ä‡πâ Snapshot
- Item/Category ‡∏ñ‡∏π‡∏Å‡∏•‡∏ö ‚Üí ‡πÉ‡∏ä‡πâ Snapshot

### 3. **‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡πÅ‡∏•‡∏∞‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏á‡πà‡∏≤‡∏¢** ‚úÖ
- ‡πÉ‡∏ä‡πâ centralized functions
- ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á copy-paste logic
- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏ó‡∏∏‡∏Å‡∏ó‡∏µ‡πà

### 4. **‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô** ‚úÖ
- ‡πÉ‡∏ä‡πâ batch functions
- ‡∏•‡∏î queries ‡∏ó‡∏µ‡πà‡∏ã‡πâ‡∏≥‡∏ã‡πâ‡∏≠‡∏ô
- ‡∏£‡∏ß‡∏° populate ‡πÉ‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß

---

## üîç ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö

### ‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£ Populate + Snapshot

#### **Populate (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡∏±‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà)**
```typescript
// ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ adminId ‚Üí Populate ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
if (issue.assignedAdminId) {
  const admin = await User.findOne({ user_id: issue.assignedAdminId });
  if (admin) {
    return { name: admin.firstName + ' ' + admin.lastName };
  }
}
```

#### **Snapshot (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡πÅ‡∏•‡πâ‡∏ß)**
```typescript
// ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ adminId (‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡πÅ‡∏•‡πâ‡∏ß) ‚Üí ‡πÉ‡∏ä‡πâ Snapshot
if (!issue.assignedAdminId) {
  return { name: issue.assignedAdmin.name }; // ‡∏à‡∏≤‡∏Å Snapshot
}
```

### ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô

#### **IssueLog (‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡∏á‡∏≤‡∏ô IT)**
```javascript
// ‡∏Å‡πà‡∏≠‡∏ô‡∏•‡∏ö Admin
{
  assignedAdminId: "ADMIN001",      // ‡∏°‡∏µ ID ‚Üí Populate ‡πÑ‡∏î‡πâ
  assignedAdmin: {
    name: "‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ",            // Snapshot ‡πÄ‡∏Å‡πà‡∏≤
    email: "somchai@example.com"
  }
}
// ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•: "‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡∏°‡∏µ‡∏™‡∏∏‡∏Ç" (Populate ‡∏à‡∏≤‡∏Å User collection)

// ‡∏´‡∏•‡∏±‡∏á‡∏•‡∏ö Admin
{
  assignedAdminId: null,             // ‡πÑ‡∏°‡πà‡∏°‡∏µ ID ‚Üí ‡πÉ‡∏ä‡πâ Snapshot
  assignedAdmin: {
    name: "‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡∏°‡∏µ‡∏™‡∏∏‡∏Ç",            // Snapshot ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
    email: "somchai@example.com"
  }
}
// ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•: "‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡∏°‡∏µ‡∏™‡∏∏‡∏Ç" (‡∏à‡∏≤‡∏Å Snapshot)
```

#### **Equipment Logs**
```javascript
// RequestLog
{
  approvedBy: "ADMIN001",           // ‡∏°‡∏µ ID ‚Üí Populate ‡πÑ‡∏î‡πâ
  approvedByName: undefined         // ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å populate ‡∏ï‡∏≠‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
}
// ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•: populate ‡∏à‡∏≤‡∏Å User collection

// ‡∏´‡∏•‡∏±‡∏á‡∏•‡∏ö Admin
{
  approvedBy: "ADMIN001",           // ‡∏¢‡∏±‡∏á‡∏°‡∏µ ID (‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á)
  approvedByName: "‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡∏°‡∏µ‡∏™‡∏∏‡∏Ç"     // Snapshot ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
}
// ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•: "‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡∏°‡∏µ‡∏™‡∏∏‡∏Ç" (‡∏à‡∏≤‡∏Å Snapshot)
```

---

## üõ°Ô∏è ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•

### ‡∏Å‡∏≤‡∏£‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö

#### **User**
- ‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏≠‡∏á
- ‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏á‡∏≤‡∏ô IT ‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö
- ‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á Auto-Return Log
- ‚úÖ Snapshot ‡∏Å‡πà‡∏≠‡∏ô‡∏•‡∏ö

#### **Config (Status/Condition)**
- ‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÉ‡∏ô Inventory
- ‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÉ‡∏ô Logs
- ‚úÖ ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö System Config
- ‚úÖ Snapshot ‡∏Å‡πà‡∏≠‡∏ô‡∏•‡∏ö/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç

#### **Item/Category**
- ‚úÖ Populate ‡∏ä‡∏∑‡πà‡∏≠‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏à‡∏≤‡∏Å InventoryMaster
- ‚úÖ Fallback to snapshot ‡∏ñ‡πâ‡∏≤‡∏ñ‡∏π‡∏Å‡∏•‡∏ö

---

## üìö ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á

### Core Libraries
```
src/lib/
‚îú‚îÄ‚îÄ snapshot-helpers.ts              ‚úÖ Snapshot IssueLog
‚îú‚îÄ‚îÄ equipment-snapshot-helpers.ts    ‚úÖ Snapshot Equipment Logs + Config
‚îú‚îÄ‚îÄ equipment-populate-helpers.ts    ‚úÖ Populate Equipment Logs
‚îú‚îÄ‚îÄ issue-helpers.ts                 ‚úÖ Populate IssueLog
‚îî‚îÄ‚îÄ item-name-resolver.ts           ‚úÖ Resolve Item Names
```

### API Routes
```
src/app/api/
‚îú‚îÄ‚îÄ admin/
‚îÇ   ‚îú‚îÄ‚îÄ it-reports/route.ts                          ‚úÖ ‡πÉ‡∏ä‡πâ populate
‚îÇ   ‚îú‚îÄ‚îÄ equipment-reports/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ requests/route.ts                        ‚úÖ ‡πÉ‡∏ä‡πâ populate
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ returns/route.ts                         ‚úÖ ‡πÉ‡∏ä‡πâ populate
‚îÇ   ‚îî‚îÄ‚îÄ inventory-config/
‚îÇ       ‚îú‚îÄ‚îÄ statuses/[id]/route.ts                   ‚úÖ ‡∏°‡∏µ snapshot
‚îÇ       ‚îî‚îÄ‚îÄ conditions/[id]/route.ts                 ‚úÖ ‡∏°‡∏µ snapshot
‚îî‚îÄ‚îÄ user/
    ‚îú‚îÄ‚îÄ issues/route.ts                              ‚úÖ ‡πÉ‡∏ä‡πâ populate
    ‚îú‚îÄ‚îÄ owned-equipment/route.ts                     ‚úÖ ‡πÉ‡∏ä‡πâ populate
    ‚îî‚îÄ‚îÄ return-logs/route.ts                         ‚úÖ ‡πÉ‡∏ä‡πâ populate
```

---

## üéì Best Practices

### 1. **‡πÉ‡∏ä‡πâ Populate Functions ‡πÄ‡∏™‡∏°‡∏≠**
```typescript
// ‚ùå ‡πÑ‡∏°‡πà‡∏î‡∏µ: Manual populate
const userName = await getUserName(userId);

// ‚úÖ ‡∏î‡∏µ: ‡πÉ‡∏ä‡πâ populate function
const populated = await populateRequestLogComplete(requestLog);
```

### 2. **‡πÉ‡∏ä‡πâ Batch Functions ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏•‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£**
```typescript
// ‚ùå ‡πÑ‡∏°‡πà‡∏î‡∏µ: Loop populate
const results = [];
for (const log of logs) {
  results.push(await populateRequestLogComplete(log));
}

// ‚úÖ ‡∏î‡∏µ: Batch populate
const results = await populateRequestLogCompleteBatch(logs);
```

### 3. **Snapshot ‡∏Å‡πà‡∏≠‡∏ô‡∏•‡∏ö/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏™‡∏°‡∏≠**
```typescript
// ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏•‡∏ö User
await snapshotUserBeforeDelete(userId);
await User.findByIdAndDelete(userId);

// ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Status
await snapshotStatusConfigBeforeChange(statusId, newName);
await config.save();
```

---

## üîÆ ‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï (Future Improvements)

### ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡∏ó‡∏≥‡πÑ‡∏î‡πâ
1. **TransferLog Snapshot** - ‡πÄ‡∏û‡∏¥‡πà‡∏° snapshot ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö TransferLog
2. **Category Snapshot** - ‡πÄ‡∏û‡∏¥‡πà‡∏° snapshot ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏•‡∏ö/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Category
3. **Automated Tests** - ‡∏™‡∏£‡πâ‡∏≤‡∏á unit tests ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö populate functions
4. **Performance Optimization** - ‡πÄ‡∏û‡∏¥‡πà‡∏° caching ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö populate results

### ‡πÅ‡∏ï‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏î‡∏µ‡πÅ‡∏•‡πâ‡∏ß
- ‚úÖ ‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°‡∏ó‡∏∏‡∏Å use cases ‡∏´‡∏•‡∏±‡∏Å
- ‚úÖ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
- ‚úÖ ‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡πÅ‡∏•‡∏∞‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏á‡πà‡∏≤‡∏¢
- ‚úÖ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á

---

## üìù ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Developer

### ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡πÉ‡∏´‡∏°‡πà

#### 1. **‡πÄ‡∏û‡∏¥‡πà‡∏° Log ‡πÉ‡∏´‡∏°‡πà**
```typescript
// 1. ‡∏™‡∏£‡πâ‡∏≤‡∏á Model ‡∏û‡∏£‡πâ‡∏≠‡∏° ID fields
{
  userId: string,           // ‡πÄ‡∏Å‡πá‡∏ö ID ‡πÄ‡∏™‡∏°‡∏≠
  userName?: string         // Snapshot (optional)
}

// 2. ‡πÄ‡∏û‡∏¥‡πà‡∏° populate function
export async function populateNewLog(log: any) {
  if (log.userId) {
    const user = await User.findOne({ user_id: log.userId });
    if (user) {
      log.userName = user.firstName + ' ' + user.lastName;
    }
  }
  return log;
}

// 3. ‡πÄ‡∏û‡∏¥‡πà‡∏° snapshot function
export async function snapshotNewLogBeforeUserDelete(userId: string) {
  const userName = await getUserName(userId);
  await NewLog.updateMany(
    { userId },
    { $set: { userName } }
  );
}
```

#### 2. **‡πÄ‡∏û‡∏¥‡πà‡∏° Config ‡πÉ‡∏´‡∏°‡πà**
```typescript
// 1. ‡πÄ‡∏û‡∏¥‡πà‡∏° check usage function
export async function checkNewConfigUsage(configId: string) {
  const count = await SomeLog.countDocuments({ 
    'someField': configId 
  });
  return { total: count, isUsed: count > 0 };
}

// 2. ‡πÄ‡∏û‡∏¥‡πà‡∏° snapshot function
export async function snapshotNewConfigBeforeChange(
  configId: string, 
  newName?: string
) {
  const configName = newName || await getConfigName(configId);
  await SomeLog.updateMany(
    { 'someField': configId },
    { $set: { 'someFieldName': configName } }
  );
}

// 3. ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô delete API
await checkNewConfigUsage(id);
await snapshotNewConfigBeforeChange(id);
```

---

## üì¶ Phase 6: ‡πÄ‡∏û‡∏¥‡πà‡∏° ItemName Snapshot System

### ‡∏õ‡∏±‡∏ç‡∏´‡∏≤
‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏•‡∏ö‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô `InventoryMaster` ‚Üí `RequestLog` ‡πÅ‡∏•‡∏∞ `ReturnLog` ‡∏ó‡∏µ‡πà‡∏°‡∏µ `masterId` ‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏™‡∏î‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÑ‡∏î‡πâ

### ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç

#### 1. **Models: ‡πÄ‡∏û‡∏¥‡πà‡∏° fields ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö snapshot**
- `src/models/RequestLog.ts`
  ```typescript
  export interface IRequestItem {
    masterId: string;
    itemName?: string;    // üÜï Snapshot: ‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå
    category?: string;    // üÜï Snapshot: ‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà
    categoryId?: string;  // üÜï Snapshot: ID ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà
    // ... existing fields
  }
  ```

- `src/models/ReturnLog.ts`
  ```typescript
  export interface IReturnItem {
    itemId: string;
    itemName?: string;    // üÜï Snapshot: ‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå
    category?: string;    // üÜï Snapshot: ‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà
    categoryId?: string;  // üÜï Snapshot: ID ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà
    // ... existing fields
  }
  ```

#### 2. **Snapshot Functions**
- `src/lib/equipment-snapshot-helpers.ts`
  ```typescript
  // Snapshot ItemName ‡∏Å‡πà‡∏≠‡∏ô‡∏•‡∏ö InventoryMaster
  export async function snapshotItemNameBeforeDelete(masterId: string) {
    const master = await InventoryMaster.findById(masterId);
    const itemName = master.itemName;
    const categoryName = await getCategoryName(master.categoryId);
    
    // Snapshot ‡πÉ‡∏ô RequestLog
    await RequestLog.updateMany(
      { 'items.masterId': masterId },
      { 
        $set: { 
          'items.$[elem].itemName': itemName,
          'items.$[elem].category': categoryName,
          'items.$[elem].categoryId': master.categoryId
        } 
      },
      { arrayFilters: [{ 'elem.masterId': masterId }] }
    );
  }
  
  // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô InventoryMaster
  export async function checkInventoryMasterUsage(masterId: string) {
    const requestCount = await RequestLog.countDocuments({
      'items.masterId': masterId
    });
    return { total: requestCount, isUsed: requestCount > 0 };
  }
  ```

#### 3. **Populate Functions: ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö snapshot**
- `src/lib/equipment-populate-helpers.ts`
  ```typescript
  // Populate item name ‡πÅ‡∏•‡∏∞ category (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ masterId ‡πÅ‡∏•‡∏∞‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ snapshot)
  if (item.masterId && !item.itemName) {
    const itemInfo = await getItemNameAndCategory(item.masterId);
    if (itemInfo) {
      item.itemName = itemInfo.itemName;
      item.category = itemInfo.category;
      item.categoryId = itemInfo.categoryId;
    } else {
      // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠ (InventoryMaster ‡∏ñ‡∏π‡∏Å‡∏•‡∏ö) ‡πÉ‡∏ä‡πâ fallback
      item.itemName = item.itemName || `[Deleted Item: ${item.masterId}]`;
    }
  }
  // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ itemName ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß (snapshot) ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á populate
  ```

#### 4. **API: ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å snapshot ‡∏Å‡πà‡∏≠‡∏ô‡∏•‡∏ö**
- `src/app/api/admin/inventory/route.ts`
  ```typescript
  // DELETE operation
  if (willDeleteAll) {
    // üÜï Snapshot itemName ‡∏Å‡πà‡∏≠‡∏ô‡∏•‡∏ö InventoryMaster
    if (inventoryMaster) {
      const { snapshotItemNameBeforeDelete } = await import('@/lib/equipment-snapshot-helpers');
      await snapshotItemNameBeforeDelete(inventoryMasterId);
    }
    
    // ‡∏•‡∏ö InventoryMaster
    await InventoryMaster.deleteOne({ itemName, categoryId: category });
  }
  ```

### ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
‚úÖ RequestLog ‡πÅ‡∏•‡∏∞ ReturnLog ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÑ‡∏î‡πâ‡πÅ‡∏°‡πâ InventoryMaster ‡∏ñ‡∏π‡∏Å‡∏•‡∏ö  
‚úÖ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢  
‚úÖ ‡πÉ‡∏ä‡πâ populate ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà  

---

## ‚úÖ Checklist ‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö

### ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Populate System
- [ ] Admin ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠ ‚Üí ‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
- [ ] User ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠ ‚Üí ‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
- [ ] Status ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠ ‚Üí ‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
- [ ] Condition ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠ ‚Üí ‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
- [ ] Category ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠ ‚Üí ‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
- [ ] Item Name ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô ‚Üí ‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏±‡∏ô‡∏ó‡∏µ

### ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Snapshot System
- [ ] ‡∏•‡∏ö User ‚Üí ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡πà‡∏≤‡∏¢‡∏±‡∏á‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥
- [ ] ‡∏•‡∏ö Admin ‚Üí ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡πà‡∏≤‡∏¢‡∏±‡∏á‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥
- [ ] ‡∏•‡∏ö Status ‚Üí ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡πà‡∏≤‡∏¢‡∏±‡∏á‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥
- [ ] ‡∏•‡∏ö Condition ‚Üí ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡πà‡∏≤‡∏¢‡∏±‡∏á‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥
- [ ] ‡∏•‡∏ö Category ‚Üí ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡πà‡∏≤‡∏¢‡∏±‡∏á‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥
- [ ] ‡∏•‡∏ö InventoryMaster ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‚Üí ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡πà‡∏≤‡∏¢‡∏±‡∏á‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥

### ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Config Deletion
- [ ] ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö Status ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
- [ ] ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö Condition ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
- [ ] ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö Category ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
- [ ] ‡πÅ‡∏™‡∏î‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
- [ ] Snapshot ‡∏Å‡πà‡∏≠‡∏ô‡∏•‡∏ö‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á

---

## üéâ ‡∏™‡∏£‡∏∏‡∏õ

‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏ô‡∏µ‡πâ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏ö Populate + Snapshot ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì:

‚úÖ **‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå** - ‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°‡∏ó‡∏∏‡∏Å use cases  
‚úÖ **‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á** - Snapshot ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•  
‚úÖ **‡πÄ‡∏õ‡πá‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô** - ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡πÄ‡∏™‡∏°‡∏≠  
‚úÖ **‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢** - ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏´‡∏≤‡∏¢  
‚úÖ **‡∏™‡∏∞‡∏≠‡∏≤‡∏î** - ‡πÇ‡∏Ñ‡πâ‡∏î‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢ ‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏á‡πà‡∏≤‡∏¢  

**‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á‡πÅ‡∏•‡πâ‡∏ß!** üöÄ

---

**‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏î‡∏¢**: AI Assistant  
**‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà**: 15 ‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏° 2568  
**‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô**: 1.1 (‡πÄ‡∏û‡∏¥‡πà‡∏° ItemName Snapshot)

