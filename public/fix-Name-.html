<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fix AIS Inventory</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      max-width: 600px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .card {
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    h1 {
      color: #333;
      margin-top: 0;
    }
    button {
      background: #4CAF50;
      color: white;
      border: none;
      padding: 15px 30px;
      font-size: 16px;
      border-radius: 5px;
      cursor: pointer;
      width: 100%;
      margin: 10px 0;
    }
    button:hover {
      background: #45a049;
    }
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    .check-btn {
      background: #2196F3;
    }
    .check-btn:hover {
      background: #0b7dda;
    }
    #result {
      margin-top: 20px;
      padding: 15px;
      border-radius: 5px;
      white-space: pre-wrap;
      word-wrap: break-word;
    }
    .success {
      background: #d4edda;
      border: 1px solid #c3e6cb;
      color: #155724;
    }
    .error {
      background: #f8d7da;
      border: 1px solid #f5c6cb;
      color: #721c24;
    }
    .info {
      background: #d1ecf1;
      border: 1px solid #bee5eb;
      color: #0c5460;
    }
  </style>
</head>
<body>
  <div class="card">
    <h1>üîß ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç AIS Inventory</h1>
    <p>‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏ö‡∏ß‡πà‡∏≤ AIS ‡∏°‡∏µ <code>totalQuantity = 0</code> ‡πÅ‡∏ï‡πà‡∏°‡∏µ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏à‡∏£‡∏¥‡∏á‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>
    
    <button class="check-btn" onclick="checkInventory()">
      1Ô∏è‚É£ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• AIS
    </button>
    
    <button onclick="fixInventory()">
      2Ô∏è‚É£ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç InventoryMaster
    </button>
    
    <button style="background: #FF9800;" onclick="forceUpdate()">
      üîß Force Update (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏ö‡∏ö‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)
    </button>
    
    <div id="result"></div>
  </div>

  <script>
    async function checkInventory() {
      const resultDiv = document.getElementById('result');
      resultDiv.className = 'info';
      resultDiv.textContent = '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...';
      
      try {
        const response = await fetch('/api/debug/check-inventory?itemName=AIS');
        const data = await response.json();
        
        resultDiv.className = 'info';
        resultDiv.textContent = 
          'üìä ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö AIS:\n\n' +
          `‚Ä¢ ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏à‡∏£‡∏¥‡∏á: ${data.inventoryItems.count} ‡∏ä‡∏¥‡πâ‡∏ô\n` +
          `‚Ä¢ InventoryMaster.totalQuantity: ${data.inventoryMaster?.totalQuantity || 0}\n` +
          `‚Ä¢ InventoryMaster.availableQuantity: ${data.inventoryMaster?.availableQuantity || 0}\n\n` +
          `üîç ‡∏ß‡∏¥‡∏ô‡∏¥‡∏à‡∏â‡∏±‡∏¢: ${data.diagnosis.issue}\n\n` +
          `‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå:\n` +
          data.inventoryItems.items.map((item, i) => 
            `  ${i+1}. ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ${item.statusId}, ‡∏™‡∏†‡∏≤‡∏û: ${item.conditionId}, Owner: ${item.ownerType}`
          ).join('\n');
      } catch (error) {
        resultDiv.className = 'error';
        resultDiv.textContent = '‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message;
      }
    }

    async function fixInventory() {
      const resultDiv = document.getElementById('result');
      
      if (!confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç InventoryMaster ‡∏Ç‡∏≠‡∏á AIS ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
        return;
      }
      
      resultDiv.className = 'info';
      resultDiv.textContent = '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç...';
      
      try {
        const response = await fetch('/api/debug/fix-inventory-master', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ 
            itemName: 'AIS', 
            categoryId: 'cat_sim_card' 
          })
        });
        
        const data = await response.json();
        
        if (response.ok) {
          resultDiv.className = 'success';
          resultDiv.textContent = 
            '‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!\n\n' +
            `‚Ä¢ totalQuantity: ${data.result.totalQuantity}\n` +
            `‚Ä¢ availableQuantity: ${data.result.availableQuantity}\n` +
            `‚Ä¢ userOwnedQuantity: ${data.result.userOwnedQuantity}\n\n` +
            `üîß ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ${JSON.stringify(data.result.statusBreakdown, null, 2)}\n` +
            `üîß ‡∏™‡∏†‡∏≤‡∏û: ${JSON.stringify(data.result.conditionBreakdown, null, 2)}\n\n` +
            'üëâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤ Refresh ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏•‡∏±‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (Ctrl+Shift+R)';
        } else {
          resultDiv.className = 'error';
          resultDiv.textContent = '‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + (data.error || 'Unknown error');
        }
      } catch (error) {
        resultDiv.className = 'error';
        resultDiv.textContent = '‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message;
      }
    }
  </script>
</body>
</html>

