# üì∏ ‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏£‡∏∞‡∏ö‡∏ö Snapshot ‡∏â‡∏ö‡∏±‡∏ö‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå

> **‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏£‡∏ß‡∏°**: ‡∏£‡∏∞‡∏ö‡∏ö Snapshot ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏∏‡∏Å Logs ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå  
> **‡∏£‡∏∏‡πà‡∏ô**: v4.0 - Complete System (‡∏£‡∏ß‡∏°‡∏ó‡∏∏‡∏Å‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£)  
> **‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ó‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î**: ‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏° 2568  
> **‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞**: ‚úÖ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô

---

## üìã **‡∏™‡∏≤‡∏£‡∏ö‡∏±‡∏ç**

### [‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 1: ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏£‡∏∞‡∏ö‡∏ö](#‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà-1-‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏£‡∏∞‡∏ö‡∏ö)
- ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡πÅ‡∏•‡∏∞‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
- ‡∏™‡∏ñ‡∏≤‡∏õ‡∏±‡∏ï‡∏¢‡∏Å‡∏£‡∏£‡∏°‡∏£‡∏∞‡∏ö‡∏ö
- ‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£ Hybrid Approach

### [‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 2: ‡∏£‡∏∞‡∏ö‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡∏∞‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô](#‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà-2-‡∏£‡∏∞‡∏ö‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡∏∞‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô)
- DeletedUsers Collection
- ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏• vs ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏≤‡∏Ç‡∏≤
- ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô

### [‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 3: Equipment Tracking Snapshot](#‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà-3-equipment-tracking-snapshot)
- ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• RequestLog/ReturnLog
- ‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô (‡πÄ‡∏ö‡∏¥‡∏Å/‡∏Ñ‡∏∑‡∏ô/‡∏•‡∏ö)
- Equipment Tracking Display

### [‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 4: Issue Log Snapshot](#‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà-4-issue-log-snapshot)
- ‡∏£‡∏∞‡∏ö‡∏ö‡∏ú‡∏π‡πâ‡πÅ‡∏à‡πâ‡∏á‡∏á‡∏≤‡∏ô (Requester)
- ‡∏£‡∏∞‡∏ö‡∏ö IT Admin
- ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Status & Condition

### [‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 5: Config Management](#‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà-5-config-management)
- Category, Status, Condition Configs
- ‡∏Å‡∏≤‡∏£ Snapshot ‡∏Å‡πà‡∏≠‡∏ô‡∏•‡∏ö/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
- Bulk Update Operations

### [‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 6: Populate Functions](#‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà-6-populate-functions)
- Equipment Populate Helpers
- Issue Populate Helpers
- Priority ‡πÅ‡∏•‡∏∞ Fallback Logic

### [‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 7: ‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö](#‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà-7-‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö)
- Test Scenarios ‡∏ó‡∏±‡πâ‡∏á 7 ‡∏Å‡∏£‡∏ì‡∏µ
- Expected Results
- ‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Database

### [‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 8: ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞ Best Practices](#‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà-8-‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞-best-practices)
- API Endpoints
- Helper Functions
- ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£‡∏£‡∏∞‡∏ß‡∏±‡∏á

---

# ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 1: ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏£‡∏∞‡∏ö‡∏ö

## üéØ **‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå**

‡∏£‡∏∞‡∏ö‡∏ö Snapshot ‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏°‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Å‡∏≤‡∏£‡∏™‡∏π‡∏ç‡∏´‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥:

### ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÄ‡∏î‡∏¥‡∏°:
```
‚ùå ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ U004 ‡∏ñ‡∏π‡∏Å‡∏•‡∏ö
   ‚Üí ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á /admin/equipment-reports ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏õ‡πá‡∏ô "-"
   ‚Üí ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á /admin/it-reports ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏õ‡πá‡∏ô "-"
   ‚Üí ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á /it-tracking ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏õ‡πá‡∏ô "-"

‚ùå ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ñ‡∏π‡∏Å‡∏•‡∏ö
   ‚Üí ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å/‡∏Ñ‡∏∑‡∏ô‡πÅ‡∏™‡∏î‡∏á "Unknown"
   ‚Üí ‡∏•‡∏ö InventoryMaster ‚Üí ‡∏´‡∏≤ masterId ‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠

‚ùå Config ‡∏ñ‡∏π‡∏Å‡∏•‡∏ö/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
   ‚Üí ‡∏•‡∏ö Status Config ‚Üí ‡πÑ‡∏°‡πà‡∏£‡∏π‡πâ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏î‡∏¥‡∏°
   ‚Üí ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ä‡∏∑‡πà‡∏≠ ‚Üí ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á
```

### ‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:
```
‚úÖ ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ U004 ‡∏ñ‡∏π‡∏Å‡∏•‡∏ö
   ‚Üí ‡∏™‡∏£‡πâ‡∏≤‡∏á Snapshot ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏•‡∏ö
   ‚Üí ‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô DeletedUsers collection
   ‚Üí Populate ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å DeletedUsers ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
   ‚Üí ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‚úÖ

‚úÖ ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ñ‡∏π‡∏Å‡∏•‡∏ö
   ‚Üí Snapshot itemName, category ‡∏•‡∏á‡πÉ‡∏ô RequestLog
   ‚Üí ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏à‡∏≤‡∏Å Snapshot ‡πÅ‡∏ó‡∏ô real-time lookup

‚úÖ Config ‡∏ñ‡∏π‡∏Å‡∏•‡∏ö/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
   ‚Üí Snapshot ‡∏ä‡∏∑‡πà‡∏≠‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏•‡∏á‡πÉ‡∏ô Equipment Logs
   ‚Üí ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÅ‡∏™‡∏î‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
```

---

## üèóÔ∏è **‡∏™‡∏ñ‡∏≤‡∏õ‡∏±‡∏ï‡∏¢‡∏Å‡∏£‡∏£‡∏°**

### **Database Collections**

```
Users (‡∏´‡∏•‡∏±‡∏Å)
  ‚Üì (‡∏•‡∏ö)
DeletedUsers (snapshot)

InventoryMaster (‡∏´‡∏•‡∏±‡∏Å)
  ‚Üì (‡∏•‡∏ö)
RequestLog.items[].itemName (snapshot)

InventoryConfig (‡∏´‡∏•‡∏±‡∏Å)
  ‚Üì (‡∏•‡∏ö/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç)
RequestLog.items[].categoryName (snapshot)
RequestLog.items[].statusOnRequestName (snapshot)
RequestLog.items[].conditionOnRequestName (snapshot)

Collections ‡∏ó‡∏µ‡πà‡∏°‡∏µ Snapshot:
‚îú‚îÄ‚îÄ RequestLog (+ snapshot)  ‚Üê ‡πÄ‡∏Å‡πá‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å
‚îú‚îÄ‚îÄ ReturnLog (+ snapshot)   ‚Üê ‡πÄ‡∏Å‡πá‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∑‡∏ô
‚îú‚îÄ‚îÄ TransferLog (+ snapshot) ‚Üê ‡πÄ‡∏Å‡πá‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡∏¢‡πâ‡∏≤‡∏¢
‚îú‚îÄ‚îÄ IssueLog (+ snapshot)    ‚Üê ‡πÄ‡∏Å‡πá‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÅ‡∏à‡πâ‡∏á‡∏á‡∏≤‡∏ô IT
‚îî‚îÄ‚îÄ DeletedUsers (snapshot)  ‚Üê ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏•‡∏ö
```

---

## üí° **‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£ Hybrid Approach**

### **‡πÅ‡∏ô‡∏ß‡∏Ñ‡∏¥‡∏î: Snapshot 2 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á**

#### **1. ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà 1: ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏ö‡∏¥‡∏Å/‡∏Ñ‡∏∑‡∏ô/‡πÅ‡∏à‡πâ‡∏á‡∏á‡∏≤‡∏ô** üì¶
```
‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• "‡∏ì ‡∏ï‡∏≠‡∏ô‡∏ô‡∏±‡πâ‡∏ô" ‚Üí Historical Accuracy
```

**‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•:**
- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• historical ‡∏ï‡πâ‡∏≠‡∏á‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
- ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏†‡∏≤‡∏û‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ï‡∏≠‡∏ô‡πÄ‡∏ö‡∏¥‡∏Å/‡∏Ñ‡∏∑‡∏ô

#### **2. ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà 2: ‡∏Å‡πà‡∏≠‡∏ô‡∏•‡∏ö** üóëÔ∏è
```
‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏õ‡πá‡∏ô "‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î" ‚Üí ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏≤‡∏¢
```

**‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•:**
- ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏•‡∏ö‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏°‡∏µ snapshot (‡πÉ‡∏ä‡πâ real-time)
- ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏•‡∏ö‡πÅ‡∏•‡πâ‡∏ß snapshot ‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î

### **‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô:**

```typescript
// ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 1: ‡πÄ‡∏ö‡∏¥‡∏Å Mouse
Admin ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ ‚Üí ‡∏™‡∏£‡πâ‡∏≤‡∏á snapshot {
  itemName: "Mouse",
  statusName: "‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ",
  conditionName: "‡∏î‡∏µ"
}

// ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 5: ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå
Admin ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Mouse ‚Üí "‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ" ‚Üí "‡∏ä‡∏≥‡∏£‡∏∏‡∏î"
‚Üí ‚è∏Ô∏è Snapshot ‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô (‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡πÄ‡∏õ‡πá‡∏ô "‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ")

// ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 10: ‡∏•‡∏ö‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå
Admin ‡∏Å‡∏î‡∏•‡∏ö Mouse
‚Üí üì∏ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï snapshot ‡πÄ‡∏õ‡πá‡∏ô "‡∏ä‡∏≥‡∏£‡∏∏‡∏î" (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î)
‚Üí ‡∏•‡∏ö InventoryItem

// ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 15: ‡∏î‡∏π‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÄ‡∏ö‡∏¥‡∏Å
Equipment Tracking
‚Üí ‚úÖ ‡πÅ‡∏™‡∏î‡∏á "Mouse - ‡∏ä‡∏≥‡∏£‡∏∏‡∏î" (‡∏à‡∏≤‡∏Å snapshot ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î)
```

---

# ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 2: ‡∏£‡∏∞‡∏ö‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡∏∞‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô

## üóÇÔ∏è **DeletedUsers Collection**

### **‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå**
‡πÄ‡∏Å‡πá‡∏ö Snapshot ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏•‡∏ö

### **‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•**
```typescript
interface IDeletedUser extends Document {
  userMongoId: string;     // ObjectId ‡πÉ‡∏ô MongoDB
  user_id?: string;        // ID ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö (‡πÄ‡∏ä‡πà‡∏ô "U004")
  userType?: 'individual' | 'branch';
  firstName?: string;
  lastName?: string;
  nickname?: string;
  department?: string;
  office?: string;         // ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Branch User
  phone?: string;
  email?: string;
  deletedAt: Date;         // ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏ö
  createdAt: Date;
  updatedAt: Date;
}
```

### **‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á Snapshot**
```typescript
// ‡πÉ‡∏ô API DELETE /api/admin/users/[id]
try {
  const snapData = {
    userMongoId: userToDelete._id.toString(),
    user_id: userToDelete.user_id,
    userType: userToDelete.userType,
    firstName: userToDelete.firstName,
    lastName: userToDelete.lastName,
    nickname: userToDelete.nickname,
    department: userToDelete.department,
    office: userToDelete.office,
    phone: userToDelete.phone,
    email: userToDelete.email,
    deletedAt: new Date()
  };
  
  await DeletedUsers.findOneAndUpdate(
    { userMongoId: snapData.userMongoId },
    snapData,
    { upsert: true, new: true }
  );
  
  console.log(`üì∏ Snapshot user data to DeletedUsers: ${userToDelete.userType} - ${snapData.user_id}`);
} catch (e) {
  console.error('Failed to snapshot user before delete:', e);
}
```

---

## üë§ **‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏• (Individual User)**

### **‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£**
- **‡∏¢‡∏±‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà:** ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Real-time ‡∏ó‡∏∏‡∏Å‡∏ü‡∏¥‡∏•‡∏î‡πå
- **‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡πÅ‡∏•‡πâ‡∏ß:** ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å DeletedUsers ‡∏ó‡∏∏‡∏Å‡∏ü‡∏¥‡∏•‡∏î‡πå

### **‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á**
```typescript
// ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏• U001
{
  userType: 'individual',
  firstName: '‡∏™‡∏°‡∏ä‡∏≤‡∏¢',
  lastName: '‡πÉ‡∏à‡∏î‡∏µ',
  department: 'IT',
  office: '‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û'
}

// ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ñ‡∏π‡∏Å‡∏•‡∏ö ‚Üí DeletedUsers
// ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• ‚Üí ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å DeletedUsers ‡∏ó‡∏∏‡∏Å‡∏ü‡∏¥‡∏•‡∏î‡πå
```

---

## üè¢ **‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏≤‡∏Ç‡∏≤ (Branch User)**

### **‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡πÄ‡∏®‡∏©**
- **‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß** (firstName, lastName, phone, email) ‚Üí ‡∏à‡∏≤‡∏Å‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡∏£‡∏±‡πâ‡∏á
- **‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≤‡∏Ç‡∏≤** (office) ‚Üí ‡∏à‡∏≤‡∏Å DeletedUsers (‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏•‡∏ö)

### **‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•**
‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏≤‡∏Ç‡∏≤‡∏≠‡∏≤‡∏à‡∏°‡∏µ‡∏Ñ‡∏ô‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô‡∏°‡∏≤‡πÄ‡∏ö‡∏¥‡∏Å/‡∏Ñ‡∏∑‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‡πÅ‡∏ï‡πà‡∏™‡∏≤‡∏Ç‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô

### **‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á**
```typescript
// ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏µ‡πà 1: ‡πÄ‡∏ö‡∏¥‡∏Å‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå
{
  userId: 'BRANCH001',
  requesterFirstName: '‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô A',
  requesterLastName: '‡∏™‡∏≤‡∏Ç‡∏≤‡∏†‡∏π‡πÄ‡∏Å‡πá‡∏ï',
  requesterPhone: '081-111-1111',
  requesterEmail: 'a@branch.com'
}

// ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏µ‡πà 2: ‡πÅ‡∏à‡πâ‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤ IT
{
  requesterId: 'BRANCH001',
  firstName: '‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô B',
  lastName: '‡∏™‡∏≤‡∏Ç‡∏≤‡∏†‡∏π‡πÄ‡∏Å‡πá‡∏ï',
  phone: '082-222-2222',
  email: 'b@branch.com'
}

// ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏≤‡∏Ç‡∏≤ ‚Üí DeletedUsers
{
  user_id: 'BRANCH001',
  userType: 'branch',
  office: '‡∏™‡∏≤‡∏Ç‡∏≤‡∏†‡∏π‡πÄ‡∏Å‡πá‡∏ï (Central)' // ‡∏ä‡∏∑‡πà‡∏≠‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏•‡∏ö
}

// ‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•:
// ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏µ‡πà 1: ‡∏ä‡∏∑‡πà‡∏≠ "‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô A", ‡∏™‡∏≤‡∏Ç‡∏≤ "‡∏™‡∏≤‡∏Ç‡∏≤‡∏†‡∏π‡πÄ‡∏Å‡πá‡∏ï (Central)"
// ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏µ‡πà 2: ‡∏ä‡∏∑‡πà‡∏≠ "‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô B", ‡∏™‡∏≤‡∏Ç‡∏≤ "‡∏™‡∏≤‡∏Ç‡∏≤‡∏†‡∏π‡πÄ‡∏Å‡πá‡∏ï (Central)"
```

---

## üë®‚Äçüíº **‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô**

### **‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£**
‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÉ‡∏ä‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÄ‡∏õ‡πá‡∏ô User ‡∏ó‡∏µ‡πà‡∏°‡∏µ `userRole = 'admin'` ‡∏´‡∏£‡∏∑‡∏≠ `'it_admin'`

### **‡∏Å‡∏≤‡∏£ Populate**
```typescript
// populateAdminInfo() ‡πÉ‡∏ô issue-helpers.ts
const admin = await User.findOne({ user_id: adminId });

if (admin) {
  // Real-time
  return {
    userId: admin.user_id,
    name: admin.userType === 'individual'
      ? `${admin.firstName} ${admin.lastName}`.trim()
      : admin.office,
    email: admin.email
  };
} else {
  // ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏à‡∏≤‡∏Å DeletedUsers
  const deletedAdmin = await DeletedUsers.findOne({ user_id: adminId });
  
  if (deletedAdmin) {
    return {
      userId: deletedAdmin.user_id,
      name: deletedAdmin.userType === 'individual'
        ? `${deletedAdmin.firstName} ${deletedAdmin.lastName}`.trim()
        : deletedAdmin.office || '',
      email: deletedAdmin.email || ''
    };
  }
}
```

---

# ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 3: Equipment Tracking Snapshot

## üìä **‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•**

### **RequestLog**

```typescript
interface IAssignedItemSnapshot {
  itemId: string;           // InventoryItem._id
  itemName: string;         // "Mouse Logitech"
  categoryId: string;       // "cat_accessories"
  categoryName: string;     // "‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÄ‡∏™‡∏£‡∏¥‡∏°"
  serialNumber?: string;    // "SN123"
  numberPhone?: string;     // "0812345678"
  statusId?: string;        // "status_available"
  statusName?: string;      // "‡∏°‡∏µ"
  conditionId?: string;     // "cond_working"
  conditionName?: string;   // "‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ"
}

interface IRequestLog {
  userId: string;
  status: 'approved' | 'pending' | 'rejected';
  items: [{
    masterId: string;                           // InventoryMaster._id
    itemName?: string;                          // Snapshot
    categoryId?: string;                        // Snapshot
    assignedItemIds?: string[];                 // [itemId1, itemId2]
    assignedItemSnapshots?: IAssignedItemSnapshot[];  // üÜï
    statusOnRequest?: string;                   // ID
    statusOnRequestName?: string;               // Snapshot
    conditionOnRequest?: string;                // ID
    conditionOnRequestName?: string;            // Snapshot
  }];
  approvedBy?: string;                          // ID
  approvedByName?: string;                      // Snapshot
  rejectedBy?: string;                          // ID
  rejectedByName?: string;                      // Snapshot
}
```

### **ReturnLog**

```typescript
interface IReturnLog {
  userId: string;
  items: [{
    itemId: string;                   // InventoryItem._id
    itemName?: string;                // üÜï Snapshot
    category?: string;                // üÜï Snapshot
    categoryId?: string;              // üÜï Snapshot
    serialNumber?: string;            // üÜï Snapshot
    numberPhone?: string;             // üÜï Snapshot
    statusOnReturn?: string;          // ID
    statusOnReturnName?: string;      // Snapshot
    conditionOnReturn?: string;       // ID
    conditionOnReturnName?: string;   // Snapshot
    approvedBy?: string;              // ID
    approvedByName?: string;          // Snapshot
  }];
}
```

---

## üîÑ **‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô**

### **Scenario 1: ‡πÄ‡∏ö‡∏¥‡∏Å‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå**

```
1. User ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÄ‡∏ö‡∏¥‡∏Å
   ‚Üí ‡∏™‡∏£‡πâ‡∏≤‡∏á RequestLog (status: pending)

2. Admin ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
   ‚Üí transferInventoryItem()
   ‚Üí üì∏ createInventoryItemSnapshotsBatch()
   ‚Üí ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å assignedItemSnapshots[]
   ‚Üí RequestLog (status: approved)

3. Admin ‡∏•‡∏ö‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå
   ‚Üí üì∏ updateSnapshotsBeforeDelete()
   ‚Üí ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï assignedItemSnapshots[] ‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
   ‚Üí ‡∏•‡∏ö InventoryItem
```

**API:**
- `POST /api/admin/equipment-reports/requests/[id]/approve-with-selection`

**Code:**
```typescript
// ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
const { createInventoryItemSnapshotsBatch } = await import('@/lib/snapshot-helpers');
const snapshots = await createInventoryItemSnapshotsBatch(itemIds);
requestLog.items[0].assignedItemSnapshots = snapshots;
```

### **Scenario 2: ‡∏Ñ‡∏∑‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå**

```
1. User ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏Ñ‡∏∑‡∏ô
   ‚Üí üì∏ createInventoryItemSnapshotsBatch()
   ‚Üí ‡∏™‡∏£‡πâ‡∏≤‡∏á ReturnLog ‡∏û‡∏£‡πâ‡∏≠‡∏° snapshot

2. Admin ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
   ‚Üí transferInventoryItem() ‡∏Å‡∏•‡∏±‡∏ö admin_stock
```

**API:**
- `POST /api/equipment-return`

**Code:**
```typescript
const { createInventoryItemSnapshotsBatch } = await import('@/lib/snapshot-helpers');
const snapshots = await createInventoryItemSnapshotsBatch(itemIds);

const cleanItems = returnData.items.map((item) => {
  const snapshot = snapshotMap.get(item.itemId);
  return {
    itemId: item.itemId,
    itemName: snapshot?.itemName,        // üÜï
    category: snapshot?.categoryName,    // üÜï
    categoryId: snapshot?.categoryId,    // üÜï
    serialNumber: snapshot?.serialNumber // üÜï
  };
});
```

### **Scenario 3: ‡∏•‡∏ö‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå**

```
1. Admin ‡∏Å‡∏î‡∏•‡∏ö
   ‚Üí üì∏ updateSnapshotsBeforeDelete(itemId)
   ‚Üí ‡∏´‡∏≤ RequestLog ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡∏°‡∏µ itemId
   ‚Üí ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï snapshot ‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
   ‚Üí ‡∏•‡∏ö InventoryItem
```

**API:**
- `DELETE /api/admin/inventory`
- `POST /api/admin/inventory/edit-item` (action: delete)

**Code:**
```typescript
const { updateSnapshotsBeforeDelete } = await import('@/lib/snapshot-helpers');
await updateSnapshotsBeforeDelete(itemId);
// ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï assignedItemSnapshots[] ‡πÉ‡∏ô RequestLog ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
```

### **Scenario 4: Equipment Tracking**

```
1. ‡∏î‡∏∂‡∏á InventoryItems (user_owned)
2. ‡∏î‡∏∂‡∏á RequestLogs (approved)
3. ‡∏™‡∏£‡πâ‡∏≤‡∏á itemToRequestMap ‡∏û‡∏£‡πâ‡∏≠‡∏° snapshot
4. ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•:
   - ‡∏°‡∏µ snapshot ‚Üí ‡πÉ‡∏ä‡πâ snapshot üì∏
   - ‡πÑ‡∏°‡πà‡∏°‡∏µ snapshot ‚Üí ‡πÉ‡∏ä‡πâ real-time
```

**API:**
- `GET /api/admin/equipment-tracking`

**Code:**
```typescript
// ‡∏™‡∏£‡πâ‡∏≤‡∏á map ‡∏û‡∏£‡πâ‡∏≠‡∏° snapshot
itemToRequestMap.set(snapshot.itemId, {
  snapshot: snapshot, // üÜï
  requestDate: req.requestDate
});

// ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• (Priority)
const finalItemName = 
  itemSnapshot?.itemName ||        // 1. Snapshot
  item.itemName ||                 // 2. Real-time
  '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';                       // 3. Fallback
```

---

# ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 4: Issue Log Snapshot

## üìã **‡∏£‡∏∞‡∏ö‡∏ö‡∏ú‡∏π‡πâ‡πÅ‡∏à‡πâ‡∏á‡∏á‡∏≤‡∏ô (Requester)**

### **Individual User**

**‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å:**
```typescript
{
  requesterType: 'individual',
  requesterId: 'USER123',  // populate ‡∏ó‡∏∏‡∏Å‡∏ü‡∏¥‡∏•‡∏î‡πå
  firstName: '‡∏™‡∏°‡∏ä‡∏≤‡∏¢',      // snapshot
  lastName: '‡πÉ‡∏à‡∏î‡∏µ',
  // ...
}
```

**‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•:** Populate ‡∏à‡∏≤‡∏Å User collection
**‡∏•‡∏ö:** Snapshot ‡∏ó‡∏∏‡∏Å‡∏ü‡∏¥‡∏•‡∏î‡πå

### **Branch User**

**‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å:**
```typescript
{
  requesterType: 'branch',
  requesterId: 'BRANCH001',
  officeId: '001',         // populate ‡πÄ‡∏â‡∏û‡∏≤‡∏∞ office
  firstName: '‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß A',   // snapshot
  office: '‡∏™‡∏¢‡∏≤‡∏°',          // populate
  // ...
}
```

**‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•:** Populate ‡πÄ‡∏â‡∏û‡∏≤‡∏∞ office
**‡∏•‡∏ö:** Snapshot ‡πÄ‡∏â‡∏û‡∏≤‡∏∞ office

---

## üë®‚Äçüíº **‡∏£‡∏∞‡∏ö‡∏ö IT Admin**

**‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å:**
```typescript
{
  assignedAdminId: 'ADMIN001',  // populate
  assignedAdmin: {              // snapshot
    name: '‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ',
    email: 'somchai@example.com'
  }
}
```

**‡∏•‡∏ö Admin:** Snapshot ‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡∏≠‡∏µ‡πÄ‡∏°‡∏•

---

## ‚öôÔ∏è **Status & Condition Configs**

### **RequestLog / ReturnLog**

**‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å:**
```typescript
statusOnRequest: 'status_available',    // ID
statusOnRequestName: undefined,         // populate ‡∏ï‡∏≠‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•

conditionOnRequest: 'cond_working',     // ID
conditionOnRequestName: undefined,      // populate ‡∏ï‡∏≠‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
```

**‡∏•‡∏ö Config:**
```typescript
// Snapshot ‡∏Å‡πà‡∏≠‡∏ô‡∏•‡∏ö
await snapshotStatusConfigBeforeChange('status_available', '‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ');
// ‚Üí RequestLog.statusOnRequestName = "‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ"
// ‚Üí RequestLog.statusOnRequest = null
```

---

# ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 5: Config Management

## üìÅ **Category Config**

### **‡∏Å‡∏≤‡∏£‡∏•‡∏ö/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç**
```typescript
// API: PUT/DELETE /api/admin/inventory-config/categories/[id]

// ‡∏Å‡πà‡∏≠‡∏ô‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç/‡∏•‡∏ö
await snapshotCategoryConfigBeforeChange(id, newName);

// ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:
// - RequestLog.items[].category = newName
// - ReturnLog.items[].category = newName  
// - TransferLog.categoryName = newName
```

### **Collections ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö Snapshot**
- RequestLog: `items[].category`
- ReturnLog: `items[].category`
- TransferLog: `categoryName`

---

## üìä **Status Config**

### **‡∏Å‡∏≤‡∏£‡∏•‡∏ö/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç**
```typescript
// API: PUT/DELETE /api/admin/inventory-config/statuses/[id]

// ‡∏Å‡πà‡∏≠‡∏ô‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç/‡∏•‡∏ö
await snapshotStatusConfigBeforeChange(id, newName);

// ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:
// - RequestLog.items[].statusOnRequestName = newName
// - ReturnLog.items[].statusOnReturnName = newName
```

### **Collections ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö Snapshot**
- RequestLog: `items[].statusOnRequestName`
- ReturnLog: `items[].statusOnReturnName`

---

## üè∑Ô∏è **Condition Config**

### **‡∏Å‡∏≤‡∏£‡∏•‡∏ö/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç**
```typescript
// API: PUT/DELETE /api/admin/inventory-config/conditions/[id]

// ‡∏Å‡πà‡∏≠‡∏ô‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç/‡∏•‡∏ö
await snapshotConditionConfigBeforeChange(id, newName);

// ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:
// - RequestLog.items[].conditionOnRequestName = newName
// - ReturnLog.items[].conditionOnReturnName = newName
```

### **Collections ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö Snapshot**
- RequestLog: `items[].conditionOnRequestName`
- ReturnLog: `items[].conditionOnReturnName`

---

## üîÑ **Bulk Update Operations**

### **API Endpoints**
- `POST /api/admin/inventory-config` (Bulk Update)
- `PUT /api/admin/inventory/config` (Bulk Update)

### **‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô**
```typescript
// ‡∏Å‡πà‡∏≠‡∏ô Bulk Update
try {
  const { snapshotConfigChangesBeforeBulkUpdate } = await import('@/lib/equipment-snapshot-helpers');
  const snapshotResult = await snapshotConfigChangesBeforeBulkUpdate(config, {
    categoryConfigs: categories,
    statusConfigs: statuses,
    conditionConfigs: conditions
  });
  console.log('üì∏ Bulk snapshot result:', snapshotResult);
} catch (snapshotError) {
  console.warn('Failed to snapshot config changes:', snapshotError);
  // Continue with update even if snapshot fails
}
```

---

# ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 6: Populate Functions

## üîß **Equipment Populate Helpers**

### **populateRequestLogUser()**
```typescript
// ‡∏´‡∏≤‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏à‡∏≤‡∏Å User collection
const user = await User.findOne({ user_id: requestLog.userId });

if (user) {
  if (user.userType === 'individual') {
    // ‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•: ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å User ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
    return { ...requestLog, firstName: user.firstName, ... };
  } else {
    // ‡∏™‡∏≤‡∏Ç‡∏≤: ‡πÉ‡∏ä‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≤‡∏Ç‡∏≤‡∏à‡∏≤‡∏Å User
    return { 
      ...requestLog, 
      office: user.office,
      // firstName, lastName, etc. ‡πÉ‡∏ä‡πâ‡∏à‡∏≤‡∏Å‡∏ü‡∏≠‡∏£‡πå‡∏° (requesterFirstName)
    };
  }
} else {
  // ‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠ User ‚Üí ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏à‡∏≤‡∏Å DeletedUsers
  const deletedUser = await DeletedUsers.findOne({ user_id: requestLog.userId });
  
  if (deletedUser) {
    if (deletedUser.userType === 'branch') {
      // ‡∏™‡∏≤‡∏Ç‡∏≤: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß‡∏à‡∏≤‡∏Å‡∏ü‡∏≠‡∏£‡πå‡∏°, ‡∏™‡∏≤‡∏Ç‡∏≤‡∏à‡∏≤‡∏Å DeletedUsers
      return {
        ...requestLog,
        firstName: requestLog.requesterFirstName,  // ‡∏à‡∏≤‡∏Å‡∏ü‡∏≠‡∏£‡πå‡∏°
        office: deletedUser.office                 // ‡∏à‡∏≤‡∏Å DeletedUsers
      };
    } else {
      // ‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•: ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å DeletedUsers ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
      return {
        ...requestLog,
        firstName: deletedUser.firstName,
        office: deletedUser.office,
        ...
      };
    }
  }
}
```

### **populateRequestLogItems()**
```typescript
// Populate ‡∏ä‡∏∑‡πà‡∏≠ Item, Category, Status, Condition
for (const item of requestLog.items) {
  // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ masterId ‚Üí ‡∏î‡∏∂‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏≤‡∏Å InventoryMaster (Real-time)
  if (item.masterId) {
    const master = await InventoryMaster.findById(item.masterId);
    item.itemName = master?.itemName || item.itemName;
  }
  
  // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ categoryId ‚Üí ‡∏î‡∏∂‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏≤‡∏Å CategoryConfig (Real-time)
  if (item.categoryId) {
    const config = await InventoryConfig.findOne();
    const category = config.categoryConfigs.find(c => c.id === item.categoryId);
    item.category = category?.name || item.category;
  }
  
  // ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ô‡∏Å‡∏±‡∏ö Status ‡πÅ‡∏•‡∏∞ Condition
}
```

---

## üéØ **Issue Populate Helpers**

### **populateRequesterInfo()**
```typescript
// ‡∏´‡∏≤‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏à‡∏≤‡∏Å User collection
const user = await User.findOne({ user_id: issue.requesterId });

if (user) {
  if (user.userType === 'individual') {
    // ‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•: ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å User ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
    return { ...issue, firstName: user.firstName, ... };
  } else {
    // ‡∏™‡∏≤‡∏Ç‡∏≤: ‡πÉ‡∏ä‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏™‡∏≤‡∏Ç‡∏≤‡∏à‡∏≤‡∏Å User, ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß‡∏à‡∏≤‡∏Å‡∏ü‡∏≠‡∏£‡πå‡∏°
    return { 
      ...issue, 
      office: user.office,
      firstName: issue.firstName  // ‡∏à‡∏≤‡∏Å‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏à‡πâ‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤
    };
  }
} else {
  // ‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠ User ‚Üí ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏à‡∏≤‡∏Å DeletedUsers
  const deletedUser = await DeletedUsers.findOne({ user_id: issue.requesterId });
  
  if (deletedUser) {
    if (deletedUser.userType === 'branch') {
      // ‡∏™‡∏≤‡∏Ç‡∏≤: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß‡∏à‡∏≤‡∏Å‡∏ü‡∏≠‡∏£‡πå‡∏°, ‡∏™‡∏≤‡∏Ç‡∏≤‡∏à‡∏≤‡∏Å DeletedUsers
      return {
        ...issue,
        firstName: issue.firstName,    // ‡∏à‡∏≤‡∏Å‡∏ü‡∏≠‡∏£‡πå‡∏°
        office: deletedUser.office     // ‡∏à‡∏≤‡∏Å DeletedUsers
      };
    } else {
      // ‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•: ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å DeletedUsers ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
      return {
        ...issue,
        firstName: deletedUser.firstName,
        office: deletedUser.office,
        ...
      };
    }
  }
}
```

### **populateAdminInfo()**
```typescript
// ‡∏´‡∏≤‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏à‡∏≤‡∏Å User collection
const admin = await User.findOne({ user_id: issue.assignedAdmin?.userId });

if (admin) {
  // Real-time
  return {
    ...issue,
    assignedAdmin: {
      userId: admin.user_id,
      name: admin.firstName + ' ' + admin.lastName,
      email: admin.email
    }
  };
} else {
  // ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏à‡∏≤‡∏Å DeletedUsers
  const deletedAdmin = await DeletedUsers.findOne({ user_id: issue.assignedAdmin?.userId });
  
  if (deletedAdmin) {
    return {
      ...issue,
      assignedAdmin: {
        userId: deletedAdmin.user_id,
        name: deletedAdmin.firstName + ' ' + deletedAdmin.lastName,
        email: deletedAdmin.email
      }
    };
  }
}
```

---

## üéØ **Priority ‡πÅ‡∏•‡∏∞ Fallback Logic**

### **‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç**
```
1. Snapshot (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
2. Real-time (‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡∏°‡∏µ ID)
3. Config Lookup (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ configId)
4. "‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏" (fallback ‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢)
```

### **‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á**
```typescript
// ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Status Name
const finalStatusName = 
  item.statusOnRequestName ||           // 1. Snapshot
  (await getStatusName(item.statusOnRequest)) ||  // 2. Real-time
  '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';                            // 3. Fallback
```

---

# ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 7: ‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö

## üß™ **Test Scenario: ‡∏Ñ‡∏£‡∏ö‡∏ó‡∏±‡πâ‡∏á 7 ‡∏Å‡∏£‡∏ì‡∏µ**

### **‡∏Å‡∏£‡∏ì‡∏µ 1: ‡∏•‡∏ö‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô**

**‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå:**
1. ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô ADMIN_IT ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå
2. ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô ADMIN_IT ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡πá‡∏ô "Super Admin"
3. ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô ADMIN_IT ‡∏ñ‡∏π‡∏Å‡∏•‡∏ö
4. ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ, ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå, ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà, ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞, ‡∏™‡∏†‡∏≤‡∏û ‚Üí ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î

**Expected Result:**
| ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• | ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• | ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏• |
|--------|---------|--------|
| **‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô** | "Super Admin IT" | üì∏ Snapshot ‡∏Å‡πà‡∏≠‡∏ô‡∏•‡∏ö |
| ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ | ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î | ‚úÖ ‡∏¢‡∏±‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö |
| ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå | ‡∏ä‡∏∑‡πà‡∏≠‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î | ‚úÖ ‡∏¢‡∏±‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö |
| ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà | ‡∏ä‡∏∑‡πà‡∏≠‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î | ‚úÖ ‡∏¢‡∏±‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö |
| ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ | ‡∏ä‡∏∑‡πà‡∏≠‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î | ‚úÖ ‡∏¢‡∏±‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö |
| ‡∏™‡∏†‡∏≤‡∏û | ‡∏ä‡∏∑‡πà‡∏≠‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î | ‚úÖ ‡∏¢‡∏±‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö |

### **‡∏Å‡∏£‡∏ì‡∏µ 2: ‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•**

**‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå:**
1. ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ U001 (‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•) ‡πÄ‡∏ö‡∏¥‡∏Å‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå
2. ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ U001 ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡πá‡∏ô "‡∏™‡∏°‡∏ä‡∏≤‡∏¢ (Updated)"
3. ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ U001 ‡∏ñ‡∏π‡∏Å‡∏•‡∏ö
4. ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô, ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå, ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà, ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞, ‡∏™‡∏†‡∏≤‡∏û ‚Üí ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î

**Expected Result:**
| ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• | ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• | ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏• |
|--------|---------|--------|
| **‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ** | "‡∏™‡∏°‡∏ä‡∏≤‡∏¢ (Updated)" | üì∏ Snapshot ‡∏Å‡πà‡∏≠‡∏ô‡∏•‡∏ö |
| ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô | ‡∏ä‡∏∑‡πà‡∏≠‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î | ‚úÖ ‡∏¢‡∏±‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö |
| ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå | ‡∏ä‡∏∑‡πà‡∏≠‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î | ‚úÖ ‡∏¢‡∏±‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö |
| ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà | ‡∏ä‡∏∑‡πà‡∏≠‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î | ‚úÖ ‡∏¢‡∏±‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö |
| ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ | ‡∏ä‡∏∑‡πà‡∏≠‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î | ‚úÖ ‡∏¢‡∏±‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö |
| ‡∏™‡∏†‡∏≤‡∏û | ‡∏ä‡∏∑‡πà‡∏≠‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î | ‚úÖ ‡∏¢‡∏±‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö |

### **‡∏Å‡∏£‡∏ì‡∏µ 3: ‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏≤‡∏Ç‡∏≤**

**‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå:**
1. ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏≤‡∏Ç‡∏≤ U002 ‡πÄ‡∏ö‡∏¥‡∏Å‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå (‡∏Å‡∏£‡∏≠‡∏Å‡∏ü‡∏≠‡∏£‡πå‡∏°: ‡∏ä‡∏∑‡πà‡∏≠ "‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô A", ‡πÇ‡∏ó‡∏£ "081-111", ‡∏™‡∏≤‡∏Ç‡∏≤ "‡∏†‡∏π‡πÄ‡∏Å‡πá‡∏ï")
2. ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏≤‡∏Ç‡∏≤ U002 ‡πÅ‡∏à‡πâ‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤ IT (‡∏Å‡∏£‡∏≠‡∏Å‡∏ü‡∏≠‡∏£‡πå‡∏°: ‡∏ä‡∏∑‡πà‡∏≠ "‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô B", ‡πÇ‡∏ó‡∏£ "082-222")
3. ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏≤‡∏Ç‡∏≤ U002 ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏™‡∏≤‡∏Ç‡∏≤‡πÄ‡∏õ‡πá‡∏ô "‡∏†‡∏π‡πÄ‡∏Å‡πá‡∏ï (Central)"
4. ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏≤‡∏Ç‡∏≤ U002 ‡∏ñ‡∏π‡∏Å‡∏•‡∏ö

**Expected Result:**

**‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå:**
| ‡∏ü‡∏¥‡∏•‡∏î‡πå | ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• | ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏• |
|------|---------|--------|
| ‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• | "‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô A" | üìã ‡∏à‡∏≤‡∏Å‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏ö‡∏¥‡∏Å |
| ‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå | "081-111" | üìã ‡∏à‡∏≤‡∏Å‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏ö‡∏¥‡∏Å |
| ‡∏≠‡∏µ‡πÄ‡∏°‡∏• | (‡∏ï‡∏≤‡∏°‡∏ü‡∏≠‡∏£‡πå‡∏°) | üìã ‡∏à‡∏≤‡∏Å‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏ö‡∏¥‡∏Å |
| **‡∏™‡∏≤‡∏Ç‡∏≤** | "‡∏†‡∏π‡πÄ‡∏Å‡πá‡∏ï (Central)" | üì∏ Snapshot ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏•‡∏ö |

**‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤ IT:**
| ‡∏ü‡∏¥‡∏•‡∏î‡πå | ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• | ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏• |
|------|---------|--------|
| ‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• | "‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô B" | üìã ‡∏à‡∏≤‡∏Å‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏à‡πâ‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤ |
| ‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå | "082-222" | üìã ‡∏à‡∏≤‡∏Å‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏à‡πâ‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤ |
| **‡∏™‡∏≤‡∏Ç‡∏≤** | "‡∏†‡∏π‡πÄ‡∏Å‡πá‡∏ï (Central)" | üì∏ Snapshot ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏•‡∏ö |

### **‡∏Å‡∏£‡∏ì‡∏µ 4-7: ‡∏•‡∏ö‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå, ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà, ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞, ‡∏™‡∏†‡∏≤‡∏û**

**‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô:**
- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏•‡∏ö ‚Üí ‡πÅ‡∏™‡∏î‡∏á Snapshot
- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡∏≠‡∏¢‡∏π‡πà ‚Üí ‡πÅ‡∏™‡∏î‡∏á Real-time

---

## ‚úÖ **Expected Results Summary**

| ‡∏Å‡∏£‡∏ì‡∏µ | ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ó‡∏µ‡πà‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á |
|------|------------------|
| **‡πÄ‡∏ö‡∏¥‡∏Å‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå** | ‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á snapshot ‡πÉ‡∏ô RequestLog |
| **‡∏Ñ‡∏∑‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå** | ‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á snapshot ‡πÉ‡∏ô ReturnLog |
| **‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå** | ‚è∏Ô∏è Snapshot ‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô |
| **‡∏•‡∏ö‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå** | ‚úÖ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï snapshot ‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î |
| **‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÄ‡∏ö‡∏¥‡∏Å** | ‚úÖ ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏†‡∏≤‡∏û‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏•‡∏ö (‡πÑ‡∏°‡πà‡∏°‡∏µ Unknown) |
| **‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Ñ‡∏∑‡∏ô** | ‚úÖ ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏†‡∏≤‡∏û‡∏ï‡∏≠‡∏ô‡∏Ñ‡∏∑‡∏ô (‡∏à‡∏≤‡∏Å snapshot) |
| **Equipment Tracking** | ‚úÖ ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡∏•‡∏ö‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á, ‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏Å‡∏ï‡∏¥ |
| **‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå** | ‚úÖ ‡πÑ‡∏î‡πâ ID ‡πÉ‡∏´‡∏°‡πà ‡πÅ‡∏ï‡πà snapshot ‡πÄ‡∏Å‡πà‡∏≤‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡∏≠‡∏¢‡∏π‡πà |

---

## üîç **‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Database**

### **‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö DeletedUsers**
```javascript
// MongoDB Shell
db.deletedusers.find({ user_id: "U001" }).pretty()
```

### **‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Snapshot ‡πÉ‡∏ô Logs**
```javascript
// RequestLog
db.requestlogs.find({ userId: "U001" }).pretty()

// IssueLog
db.issuelogs.find({ requesterId: "U001" }).pretty()

// ReturnLog
db.returnlogs.find({ userId: "U001" }).pretty()
```

### **‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Config Snapshots**
```javascript
// Status Snapshot
db.requestlogs.find(
  { "items.statusOnRequestName": { $exists: true } },
  { "items.statusOnRequestName": 1 }
).pretty()

// Category Snapshot
db.requestlogs.find(
  { "items.category": { $exists: true } },
  { "items.category": 1 }
).pretty()
```

---

# ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 8: ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞ Best Practices

## üìÅ **‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç**

### **Models:**
- ‚úÖ `src/models/DeletedUser.ts` - Model ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö DeletedUsers collection
- ‚úÖ `src/models/RequestLog.ts` - Model ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö RequestLog
- ‚úÖ `src/models/ReturnLog.ts` - Model ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö ReturnLog
- ‚úÖ `src/models/IssueLog.ts` - Model ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö IssueLog
- ‚úÖ `src/models/TransferLog.ts` - Model ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö TransferLog

### **Helpers:**
- ‚úÖ `src/lib/equipment-populate-helpers.ts` - Populate functions ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Equipment Logs
- ‚úÖ `src/lib/issue-helpers.ts` - Populate functions ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Issue Logs
- ‚úÖ `src/lib/equipment-snapshot-helpers.ts` - Snapshot functions ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Config, Item
- ‚úÖ `src/lib/snapshot-helpers.ts` - Snapshot functions ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö User, Admin

### **API Endpoints:**
- ‚úÖ `src/app/api/admin/users/[id]/route.ts` - ‡∏•‡∏ö User (‡∏™‡∏£‡πâ‡∏≤‡∏á DeletedUsers)
- ‚úÖ `src/app/api/admin/inventory/route.ts` - ‡∏•‡∏ö InventoryMaster (Snapshot)
- ‚úÖ `src/app/api/admin/inventory-config/categories/[id]/route.ts` - ‡∏•‡∏ö/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Category (Snapshot)
- ‚úÖ `src/app/api/admin/inventory-config/statuses/[id]/route.ts` - ‡∏•‡∏ö/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Status (Snapshot)
- ‚úÖ `src/app/api/admin/inventory-config/conditions/[id]/route.ts` - ‡∏•‡∏ö/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Condition (Snapshot)
- ‚úÖ `src/app/api/admin/equipment-reports/requests/route.ts` - ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• RequestLog (Populate)
- ‚úÖ `src/app/api/admin/equipment-reports/returns/route.ts` - ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ReturnLog (Populate)
- ‚úÖ `src/app/api/admin/it-reports/route.ts` - ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• IssueLog (Populate)
- ‚úÖ `src/app/api/user/issues/route.ts` - ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• IssueLog ‡∏Ç‡∏≠‡∏á User (Populate)

---

## üõ†Ô∏è **Helper Functions**

### **Equipment Snapshot Helpers** (`src/lib/equipment-snapshot-helpers.ts`)

| Function | ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà | Collection ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á |
|----------|---------|-------------------------|
| `getUserName()` | ‡∏î‡∏∂‡∏á‡∏ä‡∏∑‡πà‡∏≠ User ‡∏à‡∏≤‡∏Å user_id | User |
| `getStatusName()` | ‡∏î‡∏∂‡∏á‡∏ä‡∏∑‡πà‡∏≠ Status ‡∏à‡∏≤‡∏Å status_id | InventoryConfig |
| `getConditionName()` | ‡∏î‡∏∂‡∏á‡∏ä‡∏∑‡πà‡∏≠ Condition ‡∏à‡∏≤‡∏Å condition_id | InventoryConfig |
| `getCategoryName()` | ‡∏î‡∏∂‡∏á‡∏ä‡∏∑‡πà‡∏≠ Category ‡∏à‡∏≤‡∏Å category_id | InventoryConfig |
| `snapshotRequestLogsBeforeUserDelete()` | Snapshot User ‡πÉ‡∏ô RequestLog | RequestLog |
| `snapshotReturnLogsBeforeUserDelete()` | Snapshot User ‡πÉ‡∏ô ReturnLog | ReturnLog |
| `snapshotTransferLogsBeforeUserDelete()` | Snapshot User ‡πÉ‡∏ô TransferLog | TransferLog |
| `snapshotEquipmentLogsBeforeUserDelete()` | Snapshot User ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î | RequestLog, ReturnLog, TransferLog |
| `snapshotStatusConfigBeforeChange()` | Snapshot Status Config | RequestLog, ReturnLog |
| `snapshotConditionConfigBeforeChange()` | Snapshot Condition Config | RequestLog, ReturnLog |
| `snapshotCategoryConfigBeforeChange()` | Snapshot Category Config | RequestLog, ReturnLog, TransferLog |
| `snapshotItemNameBeforeDelete()` | Snapshot Item Name | RequestLog |
| `snapshotConfigChangesBeforeBulkUpdate()` | Bulk Snapshot Configs | RequestLog, ReturnLog, TransferLog |

### **Equipment Populate Helpers** (`src/lib/equipment-populate-helpers.ts`)

| Function | ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà | ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö DeletedUsers |
|----------|---------|---------------------|
| `populateRequestLogItems()` | Populate items ‡πÉ‡∏ô RequestLog | N/A (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö item data) |
| `populateReturnLogItems()` | Populate items ‡πÉ‡∏ô ReturnLog | N/A (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö item data) |
| `populateRequestLogUser()` | Populate user ‡πÉ‡∏ô RequestLog | ‚úÖ |
| `populateReturnLogUser()` | Populate user ‡πÉ‡∏ô ReturnLog | ‚úÖ |
| `populateRequestLogComplete()` | Populate ‡∏ó‡∏±‡πâ‡∏á user + items | ‚úÖ |
| `populateReturnLogComplete()` | Populate ‡∏ó‡∏±‡πâ‡∏á user + items | ‚úÖ |
| `populateTransferLog()` | Populate user ‡πÉ‡∏ô TransferLog | N/A |
| `populateRequestLogCompleteBatch()` | Batch populate RequestLog | ‚úÖ |
| `populateReturnLogCompleteBatch()` | Batch populate ReturnLog | ‚úÖ |

### **Issue Helpers** (`src/lib/issue-helpers.ts`)

| Function | ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà | ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö DeletedUsers |
|----------|---------|---------------------|
| `populateAdminInfo()` | Populate admin ‡πÉ‡∏ô IssueLog | ‚úÖ |
| `populateRequesterInfo()` | Populate requester ‡πÉ‡∏ô IssueLog | ‚úÖ |
| `populateIssueInfo()` | Populate ‡∏ó‡∏±‡πâ‡∏á requester + admin | ‚úÖ |
| `populateIssueInfoBatch()` | Batch populate IssueLog | ‚úÖ |

### **Main Snapshot Helpers** (`src/lib/snapshot-helpers.ts`)

| Function | ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà |
|----------|---------|
| `snapshotUserBeforeDelete()` | Snapshot User ‡πÉ‡∏ô IssueLog |
| `checkUserRelatedIssues()` | ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö IssueLog ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á |
| `updateSnapshotsBeforeDelete()` | Update snapshot ‡∏Å‡πà‡∏≠‡∏ô‡∏•‡∏ö InventoryItem |

---

## üìù **Best Practices**

### **1. ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á RequestLog/ReturnLog:**
```typescript
‚úÖ ‡πÉ‡∏ä‡πâ createInventoryItemSnapshotsBatch() ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
‚úÖ ‡πÄ‡∏Å‡πá‡∏ö‡∏ó‡∏±‡πâ‡∏á assignedItemIds ‡πÅ‡∏•‡∏∞ assignedItemSnapshots
‚úÖ ‡πÄ‡∏Å‡πá‡∏ö‡∏ó‡∏±‡πâ‡∏á ID ‡πÅ‡∏•‡∏∞ Name ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö status/condition
```

### **2. ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•:**
```typescript
‚úÖ ‡πÄ‡∏ä‡πá‡∏Ñ snapshot ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏™‡∏°‡∏≠
‚úÖ Fallback ‡πÑ‡∏õ real-time ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ snapshot
‚úÖ ‡πÅ‡∏™‡∏î‡∏á "‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏" ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢
```

### **3. ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏•‡∏ö‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå:**
```typescript
‚úÖ ‡πÉ‡∏ä‡πâ updateSnapshotsBeforeDelete() ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
‚úÖ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï snapshot ‡πÉ‡∏´‡πâ‡πÄ‡∏≠‡∏á
‚úÖ ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á manual update
```

### **4. Priority Order:**
```
Snapshot > Real-time > Config Lookup > "‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏"
```

---

## ‚ö†Ô∏è **‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£‡∏£‡∏∞‡∏ß‡∏±‡∏á**

### **1. ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏≤‡∏Ç‡∏≤ (Branch User)**
```
‚úÖ ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á:
- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß (‡∏ä‡∏∑‡πà‡∏≠, ‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•, ‡πÇ‡∏ó‡∏£, ‡∏≠‡∏µ‡πÄ‡∏°‡∏•) ‚Üí ‡∏à‡∏≤‡∏Å‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡∏£‡∏±‡πâ‡∏á
- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≤‡∏Ç‡∏≤ (office) ‚Üí ‡∏à‡∏≤‡∏Å DeletedUsers (‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏•‡∏ö)

‚ùå ‡∏ú‡∏¥‡∏î:
- ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≤‡∏Ç‡∏≤‡∏à‡∏≤‡∏Å‡∏ü‡∏≠‡∏£‡πå‡∏° (‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏™‡∏≤‡∏Ç‡∏≤‡πÄ‡∏Å‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏à‡∏£‡∏¥‡∏á)
```

### **2. ‡∏Å‡∏≤‡∏£‡∏•‡∏ö Config**
```
‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö Config ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÉ‡∏ô InventoryItem
- ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Å‡πà‡∏≠‡∏ô
- ‡∏ï‡πâ‡∏≠‡∏á‡∏¢‡πâ‡∏≤‡∏¢‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏ö InventoryItem ‡∏Å‡πà‡∏≠‡∏ô

‚úÖ ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡πÑ‡∏î‡πâ:
- Config ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ InventoryItem ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
- ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞ snapshot ‡∏•‡∏á‡πÉ‡∏ô RequestLog, ReturnLog, TransferLog
```

### **3. Populate Order**
```
‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£ Populate:
1. ‡∏î‡∏∂‡∏á‡∏à‡∏≤‡∏Å Collection ‡∏´‡∏•‡∏±‡∏Å (User, InventoryMaster, Config)
2. ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠ ‚Üí ‡∏î‡∏∂‡∏á‡∏à‡∏≤‡∏Å DeletedUsers
3. ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠ ‚Üí ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏Ç‡∏≠‡∏á Log
```

### **4. ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ API**
```typescript
// ‚úÖ ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á: ‡πÉ‡∏ä‡πâ API ‡∏ó‡∏µ‡πà‡∏°‡∏µ Snapshot
DELETE /api/admin/users/[id]  // ‡∏°‡∏µ snapshot ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥

// ‚ùå ‡∏ú‡∏¥‡∏î: ‡∏•‡∏ö‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á‡πÉ‡∏ô Database
await User.deleteOne({ user_id });  // ‡πÑ‡∏°‡πà‡∏°‡∏µ snapshot
```

---

## üìà **Performance**

### **‡∏Å‡∏≤‡∏£ Optimize:**
1. **Batch Populate:**
   ```typescript
   // ‚úÖ ‡∏î‡∏µ: Populate ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô
   await populateRequestLogCompleteBatch(requests);
   
   // ‚ùå ‡πÑ‡∏°‡πà‡∏î‡∏µ: Populate ‡∏ó‡∏µ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
   for (const request of requests) {
     await populateRequestLogComplete(request);
   }
   ```

2. **Index:**
   ```typescript
   // DeletedUsers collection
   { userMongoId: 1 }        // unique index
   { user_id: 1 }            // index ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
   { deletedAt: 1 }          // index ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö
   ```

3. **Select Fields:**
   ```typescript
   // ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
   await User.findOne({ user_id }).select('firstName lastName office');
   ```

---

## ‚ùì **FAQ**

### **Q1: Snapshot ‡∏à‡∏∞ auto-update ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?**
```
A: ‚ö†Ô∏è Update ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ï‡∏≠‡∏ô‡∏•‡∏ö‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
   - ‚úÖ ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏•‡∏ö ‚Üí auto-update ‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
   - ‚ùå ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç ‚Üí ‡πÑ‡∏°‡πà update (‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏ì ‡∏ï‡∏≠‡∏ô‡πÄ‡∏ö‡∏¥‡∏Å/‡∏Ñ‡∏∑‡∏ô)
```

### **Q2: RequestLog ‡πÄ‡∏Å‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ snapshot ‡∏à‡∏∞‡∏ó‡∏≥‡∏¢‡∏±‡∏á‡πÑ‡∏á?**
```
A: ‚úÖ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏≠‡∏á
   - ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏•‡∏ö‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå ‚Üí ‡∏™‡∏£‡πâ‡∏≤‡∏á snapshot ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
   - ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏•‡∏ö ‚Üí ‡πÉ‡∏ä‡πâ real-time lookup (backward compatible)
```

### **Q3: ‡∏ñ‡πâ‡∏≤‡∏•‡∏ö InventoryMaster ‡πÅ‡∏•‡πâ‡∏ß masterId ‡∏´‡∏≤‡∏¢?**
```
A: ‚úÖ ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤
   - RequestLog ‡∏°‡∏µ assignedItemSnapshots[]
   - ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏û‡∏∂‡πà‡∏á masterId ‡∏≠‡∏µ‡∏Å‡∏ï‡πà‡∏≠‡πÑ‡∏õ
```

### **Q4: ‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏î‡πâ ID ‡πÉ‡∏´‡∏°‡πà‡∏à‡∏∞‡∏ó‡∏≥‡∏¢‡∏±‡∏á‡πÑ‡∏á?**
```
A: ‚úÖ Snapshot ‡πÄ‡∏Å‡πà‡∏≤‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡∏≠‡∏¢‡∏π‡πà
   - ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÄ‡∏Å‡πà‡∏≤‡πÉ‡∏ä‡πâ snapshot (item_id ‡πÄ‡∏Å‡πà‡∏≤)
   - ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏ä‡πâ real-time (item_id ‡πÉ‡∏´‡∏°‡πà)
```

---

## üéâ **‡∏™‡∏£‡∏∏‡∏õ**

### **‡∏£‡∏∞‡∏ö‡∏ö Snapshot = Hybrid Approach**

1. ‚úÖ **Snapshot ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏ö‡∏¥‡∏Å/‡∏Ñ‡∏∑‡∏ô** - ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• historical
2. ‚úÖ **Snapshot ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏•‡∏ö** - ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
3. ‚úÖ **Backward Compatible** - RequestLog ‡πÄ‡∏Å‡πà‡∏≤‡∏¢‡∏±‡∏á‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ
4. ‚úÖ **‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á run script** - ‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏≥‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
5. ‚úÖ **Performance ‡∏î‡∏µ** - ‡πÑ‡∏°‡πà update ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç

### **‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå:**
- ‚úÖ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏π‡∏ç‡∏´‡∏≤‡∏¢‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏•‡∏ö
- ‚úÖ ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• historical ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
- ‚úÖ ‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ masterId ‡∏´‡∏≤‡∏¢‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô
- ‚úÖ ‡πÑ‡∏°‡πà‡∏°‡∏µ "Unknown" ‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á
- ‚úÖ ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏≤‡∏Ç‡∏≤‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
- ‚úÖ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Config deletion ‡πÑ‡∏î‡πâ‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå

### **‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏£‡∏∞‡∏ö‡∏ö Snapshot**

| ‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏≤‡∏£‡∏≤‡∏á | URL | ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á |
|-----------|-----|--------------|
| ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÄ‡∏ö‡∏¥‡∏Å/‡∏Ñ‡∏∑‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå | `/admin/equipment-reports` | User, Admin, Item, Category, Status, Condition |
| ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÅ‡∏à‡πâ‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤ IT | `/admin/it-reports` | User (Requester), Admin |
| ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏á‡∏≤‡∏ô IT | `/it-tracking` | User (Requester), Admin |
| ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå | `/admin/equipment-tracking` | User, Item, Category, Status, Condition |
| Dashboard | `/dashboard` | User, Item (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ) |

---

## üìö **‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°**

‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏£‡∏ß‡∏°‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏à‡∏≤‡∏Å:
- `SNAPSHOT_SYSTEM_VERIFICATION.md` - ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ‡πÅ‡∏•‡∏∞‡πÇ‡∏Ñ‡πâ‡∏î
- `SNAPSHOT_SYSTEM_TESTING_GUIDE.md` - ‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÅ‡∏ö‡∏ö‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
- `SNAPSHOT_SYSTEM_SUMMARY.md` - ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö 7 ‡∏Å‡∏£‡∏ì‡∏µ
- `SNAPSHOT_SYSTEM_README_TH.md` - ‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏â‡∏ö‡∏±‡∏ö‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå
- `SNAPSHOT_FINAL_SUMMARY.md` - ‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢

---

**‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:** ‚úÖ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô  
**‡∏£‡∏∏‡πà‡∏ô:** v4.0  
**‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ó‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î:** ‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏° 2568

üéâ **Happy Tracking!**