# üîß ‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏£‡∏∞‡∏ö‡∏ö Snapshot

**‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:** 2025-01-XX  
**‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:** üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç

---

## üìã ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏ö‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö

### üî¥ ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏£‡πâ‡∏≤‡∏¢‡πÅ‡∏£‡∏á (Critical):

| # | ‡∏ï‡∏≤‡∏£‡∏≤‡∏á | ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ | ‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö | ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ |
|---|--------|-------|---------|-------|
| 1 | `/admin/equipment-tracking` | API ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£ populate ‡∏à‡∏≤‡∏Å `DeletedUsers` | ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏•‡∏ö user ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡∏ß‡πà‡∏≤‡∏á | ‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß |
| 2 | `/admin/equipment-reports` (Request) | ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡πÅ‡∏™‡∏î‡∏á `approvedByName` / `rejectedByName` | ‡πÑ‡∏°‡πà‡∏£‡∏π‡πâ‡∏ß‡πà‡∏≤‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏Ñ‡∏ô‡πÑ‡∏´‡∏ô‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥/‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò | ‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç |
| 3 | `/admin/equipment-reports` (Return) | ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡πÅ‡∏™‡∏î‡∏á `item.approvedByName` | ‡πÑ‡∏°‡πà‡∏£‡∏π‡πâ‡∏ß‡πà‡∏≤‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏Ñ‡∏ô‡πÑ‡∏´‡∏ô‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∑‡∏ô | ‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç |
| 4 | `/admin/it-reports` | ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡πÅ‡∏™‡∏î‡∏á `assignedAdmin.name` ‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏´‡∏•‡∏±‡∏Å | ‡πÑ‡∏°‡πà‡∏£‡∏π‡πâ‡∏ß‡πà‡∏≤ IT Admin ‡∏Ñ‡∏ô‡πÑ‡∏´‡∏ô‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô | ‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç |

### ‚úÖ ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á:

| ‡∏ï‡∏≤‡∏£‡∏≤‡∏á | User Info | Admin Info | Item/Config Info | ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ |
|-------|-----------|------------|------------------|-------|
| `/it-tracking` | ‚úÖ Populate ‡∏Ñ‡∏£‡∏ö | ‚úÖ ‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á + modal | N/A | ‚úÖ **‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå** |

---

## üîß ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ó‡∏µ‡πà‡∏ó‡∏≥

### ‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ó‡∏µ‡πà 1: ‡πÄ‡∏û‡∏¥‡πà‡∏° DeletedUsers support ‡πÉ‡∏ô `/admin/equipment-tracking`

**‡πÑ‡∏ü‡∏•‡πå:** `src/app/api/admin/equipment-tracking/route.ts`

**‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á:**
1. Import `DeletedUsers` model
2. ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å fetch User ‡πÅ‡∏•‡πâ‡∏ß ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ user ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠‡πÉ‡∏ô `DeletedUsers`
3. ‡πÄ‡∏û‡∏¥‡πà‡∏° flag `_isDeleted` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏∞‡∏ö‡∏∏‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô deleted user
4. ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Branch User ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏•‡∏ö:
   - ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß ‚Üí ‡∏à‡∏≤‡∏Å `requesterInfo` (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
   - ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≤‡∏Ç‡∏≤ (`office`) ‚Üí ‡∏à‡∏≤‡∏Å `DeletedUsers`

**‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°:**
```typescript
// Fetch deleted users for users not found in active User collection
const foundUserIds = users.map((u: any) => u.user_id);
const missingUserIds = userIds.filter(id => !foundUserIds.includes(id));

if (missingUserIds.length > 0) {
  console.log(`üîç Looking for ${missingUserIds.length} deleted users...`);
  const deletedUsers = await DeletedUsers.find({ user_id: { $in: missingUserIds } }).lean();
  deletedUsers.forEach((deletedUser: any) => {
    userMap.set(deletedUser.user_id, {
      ...deletedUser,
      _isDeleted: true
    });
  });
  console.log(`üì∏ Found ${deletedUsers.length} deleted users in DeletedUsers collection`);
}
```

**‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Branch User ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏•‡∏ö:**
```typescript
// ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏≤‡∏Ç‡∏≤‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏•‡∏ö: office ‡πÉ‡∏ä‡πâ‡∏à‡∏≤‡∏Å DeletedUsers
if (isDeletedUser && user?.userType === 'branch') {
  userOffice = user.office || itemRequesterInfo.office || userOffice;
} else {
  userOffice = itemRequesterInfo.office || userOffice;
}
```

---

### ‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ó‡∏µ‡πà 2-4: ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå Admin Name ‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î

**‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß:**
1. ‚úÖ `/admin/equipment-reports` (Request Tab) - ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå "‡∏ú‡∏π‡πâ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥"
2. ‚úÖ `/admin/equipment-reports` (Return Tab) - ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå "‡∏ú‡∏π‡πâ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥"
3. ‚úÖ `/admin/it-reports` - ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå "IT Admin ‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô"

**‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á:**
- ‡πÄ‡∏û‡∏¥‡πà‡∏° header column ‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á
- ‡πÄ‡∏û‡∏¥‡πà‡∏° data column ‡πÉ‡∏ô body
- ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï colSpan ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö loading/empty states
- ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å `approvedByName`, `rejectedByName`, `assignedAdmin.name`

---

## üß™ ‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥

### Test Case 1: ‡∏•‡∏ö User ‡πÅ‡∏•‡πâ‡∏ß‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö `/admin/equipment-tracking`
```
1. ‡∏™‡∏£‡πâ‡∏≤‡∏á User U001
2. User U001 ‡πÄ‡∏ö‡∏¥‡∏Å‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå Mouse
3. ‡∏•‡∏ö User U001
4. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ï‡∏≤‡∏£‡∏≤‡∏á /admin/equipment-tracking
   Expected: ‡πÅ‡∏™‡∏î‡∏á‡∏ä‡∏∑‡πà‡∏≠ U001 ‡∏Å‡πà‡∏≠‡∏ô‡∏•‡∏ö (‡∏à‡∏≤‡∏Å DeletedUsers) ‚úÖ
```

### Test Case 2: ‡∏•‡∏ö Admin ‡πÅ‡∏•‡πâ‡∏ß‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Equipment Reports
```
1. ‡∏™‡∏£‡πâ‡∏≤‡∏á Admin ADMIN_IT
2. Admin ADMIN_IT ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å
3. ‡∏•‡∏ö Admin ADMIN_IT
4. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ï‡∏≤‡∏£‡∏≤‡∏á /admin/equipment-reports
   Expected: ‡πÅ‡∏™‡∏î‡∏á‡∏ä‡∏∑‡πà‡∏≠ ADMIN_IT ‡∏Å‡πà‡∏≠‡∏ô‡∏•‡∏ö‡πÉ‡∏ô‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå "‡∏ú‡∏π‡πâ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥" ‚úÖ
```

### Test Case 3: ‡∏•‡∏ö IT Admin ‡πÅ‡∏•‡πâ‡∏ß‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö IT Reports
```
1. ‡∏™‡∏£‡πâ‡∏≤‡∏á IT Admin ADMIN_IT
2. ADMIN_IT ‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô issue
3. ‡∏•‡∏ö ADMIN_IT
4. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ï‡∏≤‡∏£‡∏≤‡∏á /admin/it-reports
   Expected: ‡πÅ‡∏™‡∏î‡∏á‡∏ä‡∏∑‡πà‡∏≠ ADMIN_IT ‡∏Å‡πà‡∏≠‡∏ô‡∏•‡∏ö‡πÉ‡∏ô‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå "IT Admin ‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô" ‚úÖ
```

### Test Case 4: Branch User ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏•‡∏ö
```
1. ‡∏™‡∏£‡πâ‡∏≤‡∏á Branch User BRANCH001 (‡∏™‡∏≤‡∏Ç‡∏≤‡∏†‡∏π‡πÄ‡∏Å‡πá‡∏ï)
2. BRANCH001 ‡πÄ‡∏ö‡∏¥‡∏Å‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå (‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠ "‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô A")
3. ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏Ç‡∏≤‡πÄ‡∏õ‡πá‡∏ô "‡∏™‡∏≤‡∏Ç‡∏≤‡∏†‡∏π‡πÄ‡∏Å‡πá‡∏ï (Central)"
4. ‡∏•‡∏ö BRANCH001
5. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ï‡∏≤‡∏£‡∏≤‡∏á /admin/equipment-tracking
   Expected: 
   - ‡∏ä‡∏∑‡πà‡∏≠: "‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô A" (‡∏à‡∏≤‡∏Å‡∏ü‡∏≠‡∏£‡πå‡∏°)
   - ‡∏™‡∏≤‡∏Ç‡∏≤: "‡∏™‡∏≤‡∏Ç‡∏≤‡∏†‡∏π‡πÄ‡∏Å‡πá‡∏ï (Central)" (‡∏à‡∏≤‡∏Å DeletedUsers) ‚úÖ
```

---

## üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç

| ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ | ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ | ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ |
|-------|-------|----------|
| Equipment Tracking - DeletedUsers | ‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß | ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á Individual ‡πÅ‡∏•‡∏∞ Branch User |
| Equipment Reports - Admin Name | ‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß | ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå "‡∏ú‡∏π‡πâ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥" ‡πÉ‡∏ô Request & Return |
| IT Reports - Admin Name | ‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß | ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå "IT Admin ‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô" |

---

## üéâ ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç

### ‚úÖ **‡∏£‡∏∞‡∏ö‡∏ö Snapshot ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô 100%**

**Backend (API + Populate):**
- ‚úÖ ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö DeletedUsers ‡πÉ‡∏ô‡∏ó‡∏∏‡∏Å‡∏ï‡∏≤‡∏£‡∏≤‡∏á
- ‚úÖ Populate functions ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô
- ‚úÖ Snapshot ‡∏Å‡πà‡∏≠‡∏ô‡∏•‡∏ö User/Admin/Config

**Frontend (UI Display):**
- ‚úÖ ‡πÅ‡∏™‡∏î‡∏á Admin Name ‡πÉ‡∏ô‡∏ó‡∏∏‡∏Å‡∏ï‡∏≤‡∏£‡∏≤‡∏á
- ‚úÖ ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• User ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏•‡∏ö
- ‚úÖ ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Config ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏•‡∏ö

**‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô:**
- ‚úÖ **‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•** ‚Üí ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏ï‡∏≤‡∏°‡∏ó‡∏±‡∏ô‡∏ó‡∏µ (Real-time)
- ‚úÖ **‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•** ‚Üí Snapshot ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏•‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå

---

**‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î:** ‚úÖ ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î  
**‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö:** AI Assistant

